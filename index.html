
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.0">
    
    
      
        <title>IPD Documentation</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.9f615399.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.649f08f9.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#technical-reference" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="." title="IPD Documentation" class="md-header__button md-logo" aria-label="IPD Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            IPD Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Home
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="lime"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
      </label>
    
  
</form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    
  
  
    <li class="md-tabs__item md-tabs__item--active">
      <a href="." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="IPD Documentation" class="md-nav__button md-logo" aria-label="IPD Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    IPD Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Home
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="." class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#technical-reference" class="md-nav__link">
    Technical Reference
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#outline" class="md-nav__link">
    Outline
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#about" class="md-nav__link">
    1. About
  </a>
  
    <nav class="md-nav" aria-label="1. About">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#one_a" class="md-nav__link">
    1a. Getting started
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#one_b" class="md-nav__link">
    1b. Output abbreviations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#one_c" class="md-nav__link">
    1c. Project structure
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup" class="md-nav__link">
    2. Setup
  </a>
  
    <nav class="md-nav" aria-label="2. Setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#two_a" class="md-nav__link">
    2a. Dependencies
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#two_b" class="md-nav__link">
    2b. Fields
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#two_c" class="md-nav__link">
    2c. Year
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#two_d" class="md-nav__link">
    2d. States
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#two_e" class="md-nav__link">
    2e. Counties
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#two_f" class="md-nav__link">
    2f. Census API Key
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-typical-user-should-not-have-to-edit-anything-below-this-point" class="md-nav__link">
    THE TYPICAL USER SHOULD NOT HAVE TO EDIT ANYTHING BELOW THIS POINT.
  </a>
  
    <nav class="md-nav" aria-label="THE TYPICAL USER SHOULD NOT HAVE TO EDIT ANYTHING BELOW THIS POINT.">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#two_g" class="md-nav__link">
    2g. Functions
  </a>
  
    <nav class="md-nav" aria-label="2g. Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#two_g_i" class="md-nav__link">
    2g.i. Override base and stats function defaults
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#two_g_ii" class="md-nav__link">
    2g.ii. Create custom half-standard deviation breaks
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#two_g_iii" class="md-nav__link">
    2g.iii. Exception
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#two_g_iv" class="md-nav__link">
    2g.iv. Move column or vector of columns to last position
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#two_g_v" class="md-nav__link">
    2g.v. Summarize data
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#variance_replicate_table_download" class="md-nav__link">
    3. Variance replicate table download
  </a>
  
    <nav class="md-nav" aria-label="3. Variance replicate table download">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#three_a" class="md-nav__link">
    3a. Download variance replicates from Census website
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#three_b" class="md-nav__link">
    3b. Combine and format downloads
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#variance_replicate_table_processing" class="md-nav__link">
    4. Variance replicate table processing
  </a>
  
    <nav class="md-nav" aria-label="4. Variance replicate table processing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#four_a" class="md-nav__link">
    4a. Compute racial minority count MOE
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#four_b" class="md-nav__link">
    4b. Save results
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#acs_estimates_download" class="md-nav__link">
    5. ACS estimates download
  </a>
  
    <nav class="md-nav" aria-label="5. ACS estimates download">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#five_a" class="md-nav__link">
    5a. Fields
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#five_b" class="md-nav__link">
    5b. Download counts and universes from Census API
  </a>
  
    <nav class="md-nav" aria-label="5b. Download counts and universes from Census API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#five_b_i" class="md-nav__link">
    5b.i. Exception
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#five_c" class="md-nav__link">
    5c. Download percentages from Census API
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#five_d" class="md-nav__link">
    5d. Format downloads
  </a>
  
    <nav class="md-nav" aria-label="5d. Format downloads">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#five_d_i" class="md-nav__link">
    5d.i. Exception
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#five_d_ii" class="md-nav__link">
    5d.ii. Exception
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#acs_estimates_calculations" class="md-nav__link">
    6. ACS estimates calculations
  </a>
  
    <nav class="md-nav" aria-label="6. ACS estimates calculations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#six_a" class="md-nav__link">
    6a. Percentages and percentage MOEs
  </a>
  
    <nav class="md-nav" aria-label="6a. Percentages and percentage MOEs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#six_a_i" class="md-nav__link">
    6a.i. Calculation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#six_a_ii" class="md-nav__link">
    6a.ii. Result
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#six_a_iii" class="md-nav__link">
    6a.iii. Exception
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#six_a_iv" class="md-nav__link">
    6a.iv. Exception
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#six_b" class="md-nav__link">
    6b. Percentile
  </a>
  
    <nav class="md-nav" aria-label="6b. Percentile">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#six9595b_i" class="md-nav__link">
    6b.i. Calculation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#six_b_ii" class="md-nav__link">
    6b.ii. Result
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#six_c" class="md-nav__link">
    6c. IPD score and classification
  </a>
  
    <nav class="md-nav" aria-label="6c. IPD score and classification">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#six_c_i" class="md-nav__link">
    6c.i. Calculation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#six_c_ii" class="md-nav__link">
    6c.ii. Result
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#six_d" class="md-nav__link">
    6d. Composite IPD score
  </a>
  
    <nav class="md-nav" aria-label="6d. Composite IPD score">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#six_d_i" class="md-nav__link">
    6d.i. Calculation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#acs_estimates_cleaning" class="md-nav__link">
    7. ACS estimates cleaning
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary_tables" class="md-nav__link">
    8. Summary Tables
  </a>
  
    <nav class="md-nav" aria-label="8. Summary Tables">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#eight_a" class="md-nav__link">
    8a. Counts by indicator
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#eight_b" class="md-nav__link">
    8b. Breaks by indicator
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#eight_c" class="md-nav__link">
    8c. Summary by indicator
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#eight_d" class="md-nav__link">
    8d. County means by indicator
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#eight_e" class="md-nav__link">
    8e. Replacing NA with NoData if character and -99999 if numeric
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#export" class="md-nav__link">
    9. Export
  </a>
  
    <nav class="md-nav" aria-label="9. Export">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nine_a" class="md-nav__link">
    9a. Append to TIGER/LINE file
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nine_b" class="md-nav__link">
    9b. Export files
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metadata" class="md-nav__link">
    10. Metadata table with sources
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h3 id="technical-reference">Technical Reference</h3>
<h1 id="outline">Outline</h1>
<ol>
<li><a href="#about">About</a></li>
<li>1a. <a href="#one_a">Getting started</a></li>
<li><a href="#one_b">Output abbreviations</a></li>
<li><a href="#one_c">Project structure</a></li>
<li><a href="#setup">Setup</a></li>
<li><a href="#two_a">Dependencies</a></li>
<li><a href="#two_b">Fields</a></li>
<li><a href="#two_c">Year</a></li>
<li><a href="#two_d">States</a></li>
<li><a href="#two_e">Counties</a></li>
<li><a href="#two_f">Census API key</a></li>
<li><a href="#two_g">Functions</a> <ol>
<li><a href="#two_g_i">Override <code>base</code> and <code>stats</code> function defaults</a> </li>
<li><a href="#two_g_ii">Create custom half-standard deviation breaks</a> </li>
<li><a href="#two_g_iii"><em>Exception</em></a> </li>
<li><a href="#two_g_iv">Move column or vector of columns to last position</a> </li>
<li><a href="#two_g_v">Summarize data</a></li>
</ol>
</li>
<li><a href="#variance_replicate_table_download">Variance replicate table download</a></li>
<li><a href="#three_a">Download variance replicates from Census website</a></li>
<li><a href="#three_b">Combine and format downloads</a></li>
<li><a href="#variance_replicate_table_processing">Variance replicate table processing</a></li>
<li><a href="#four_a">Compute racial minority count MOE</a></li>
<li><a href="#four_b">Save results</a></li>
<li><a href="#acs_estimates_download">ACS estimates download</a></li>
<li><a href="#five_a">Fields</a></li>
<li><a href="#five_b">Download counts and universes from Census API</a> 1. <a href="#five_b_i"><em>Exception</em></a></li>
<li><a href="#five_c">Download percentages from Census API</a></li>
<li><a href="#five_d">Format downloads</a> 1. <a href="#five_d_i"><em>Exception</em></a> 2. <a href="#five_d_ii"><em>Exception</em></a> 3. <a href="#five_d_iii"><em>Exception</em></a></li>
<li><a href="#acs_estimates_calculations">ACS estimates calculations</a></li>
<li><a href="#six_a">Percentages and percentage MOEs</a> 1. <a href="#six_a_i">Calculation</a> 2. <a href="#six_a_ii">Result</a> 3. <a href="#six_a_iii"><em>Exception</em></a> 4. <a href="#six_a_iv"><em>Exception</em></a></li>
<li><a href="#six_b">Percentile</a> 1. <a href="#six_b_i">Calculation</a> 2. <a href="#six_b_ii">Result</a></li>
<li><a href="#six_c">IPD score and classification</a> 1. <a href="#six_c_i">Calculation</a> 2. <a href="#six_c_ii">Result</a></li>
<li><a href="#six_d">Composite IPD score</a> <ol>
<li><a href="#six_d_i">Calculation</a></li>
</ol>
</li>
<li><a href="#acs_estimates_cleaning">ACS estimates cleaning</a></li>
<li><a href="#summary_tables">Summary tables</a></li>
<li><a href="#eight_a">Counts by indicator</a></li>
<li><a href="#eight_b">Breaks by indicator</a></li>
<li><a href="#eight_c">Summary by indicator</a></li>
<li><a href="#eight_d">County means by indicator</a></li>
<li><a href="#eight_e">Replacing NA with NoData if character and -99999 if numeric</a></li>
<li><a href="#export">Export</a></li>
<li><a href="#nine_a">Append to TIGER/LINE file</a></li>
<li><a href="#nine_b">Export files</a></li>
<li><a href="#metadata">Metadata table with sources</a></li>
</ol>
<h1 id="about">1. About</h1>
<p>DVRPC's IPD analysis identifies populations of interest under Title VI of the Civil Rights Act and the Executive Order on Environmental Justice (#12898) using 2016â€“2020 American Community Survey (ACS) five-year estimates from the U.S. Census Bureau. IPD analysis assists both DVRPC and outside organizations in equity work by identifying populations of interest, including youth, older adults, female, racial minority, ethnic minority, foreign-born, limited English proficiency, disabled, and low-income populations at the census tract level in DVRPC's nine-county region.</p>
<p>There are many ways of identifying these populations of interest. This document discusses DVRPC's process, which is automated in an <code>R</code> script.</p>
<h2 id="one_a">1a. Getting started</h2>
<p>For guidance on software prerequisites and how to run this script, see the <a href="https://github.com/dvrpc/ipd">README.md</a></p>
<h2 id="one_b">1b. Output abbreviations</h2>
<p>Components of field names that you'll see in <code>outputs</code> and throughout the script.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Component</th>
<th style="text-align: left;">Equivalent</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">D</td>
<td style="text-align: left;">Disabled</td>
</tr>
<tr>
<td style="text-align: left;">EM</td>
<td style="text-align: left;">Ethnic Minority</td>
</tr>
<tr>
<td style="text-align: left;">F</td>
<td style="text-align: left;">Female</td>
</tr>
<tr>
<td style="text-align: left;">FB</td>
<td style="text-align: left;">Foreign-Born</td>
</tr>
<tr>
<td style="text-align: left;">LEP</td>
<td style="text-align: left;">Limited English Proficiency</td>
</tr>
<tr>
<td style="text-align: left;">LI</td>
<td style="text-align: left;">Low-Income</td>
</tr>
<tr>
<td style="text-align: left;">OA</td>
<td style="text-align: left;">Older Adults</td>
</tr>
<tr>
<td style="text-align: left;">RM</td>
<td style="text-align: left;">Racial Minority</td>
</tr>
<tr>
<td style="text-align: left;">Y</td>
<td style="text-align: left;">Youth</td>
</tr>
<tr>
<td style="text-align: left;">CntEst</td>
<td style="text-align: left;">Count Estimate</td>
</tr>
<tr>
<td style="text-align: left;">CntMOE</td>
<td style="text-align: left;">Count MOE</td>
</tr>
<tr>
<td style="text-align: left;">PctEst</td>
<td style="text-align: left;">Percentage Estimate</td>
</tr>
<tr>
<td style="text-align: left;">PctMOE</td>
<td style="text-align: left;">Percentage MOE</td>
</tr>
<tr>
<td style="text-align: left;">Pctile</td>
<td style="text-align: left;">Percentile</td>
</tr>
<tr>
<td style="text-align: left;">Score</td>
<td style="text-align: left;">Score</td>
</tr>
<tr>
<td style="text-align: left;">Class</td>
<td style="text-align: left;">Classification</td>
</tr>
</tbody>
</table>
<p><br></p>
<p>Abbreviations of field names that you'll see in <code>outputs</code> <em>not</em> comprised of the above components.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Abbreviation</th>
<th style="text-align: left;">Equivalent</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">GEOID</td>
<td style="text-align: left;">Census Tract Identifier</td>
</tr>
<tr>
<td style="text-align: left;">STATEFP</td>
<td style="text-align: left;">State FIPS Code</td>
</tr>
<tr>
<td style="text-align: left;">COUNTYFP</td>
<td style="text-align: left;">County FIPS Code</td>
</tr>
<tr>
<td style="text-align: left;">NAME</td>
<td style="text-align: left;">Census Tract FIPS Code</td>
</tr>
<tr>
<td style="text-align: left;">IPD_Score</td>
<td style="text-align: left;">Composite IPD Score</td>
</tr>
<tr>
<td style="text-align: left;">U_TPopEst</td>
<td style="text-align: left;">Total Population Estimate</td>
</tr>
<tr>
<td style="text-align: left;">U_TPopMOE</td>
<td style="text-align: left;">Total Population MOE</td>
</tr>
<tr>
<td style="text-align: left;">U_Pop5Est</td>
<td style="text-align: left;">Population 5+ Estimate</td>
</tr>
<tr>
<td style="text-align: left;">U_Pop5MOE</td>
<td style="text-align: left;">Population 5+ MOE</td>
</tr>
<tr>
<td style="text-align: left;">U_PPovEst</td>
<td style="text-align: left;">Poverty Status Population Estimate</td>
</tr>
<tr>
<td style="text-align: left;">U_PPovMOE</td>
<td style="text-align: left;">Poverty Status Population MOE</td>
</tr>
<tr>
<td style="text-align: left;">U_PNICEst</td>
<td style="text-align: left;">Non-Institutional Civilian Population Estimate</td>
</tr>
<tr>
<td style="text-align: left;">U_PNICMOE</td>
<td style="text-align: left;">Non-Institutional Civilian Population MOE</td>
</tr>
</tbody>
</table>
<h2 id="one_c">1c. Project structure</h2>
<p>This script uses relative file paths based off the location of <code>ipd.Rproj</code>. As long as you download the entire repository, the script should have no trouble locating the correct subfolders. All of the subsequent years files are based on the same architecture. The project is structured as follows:</p>
<div class="language-r highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">ipd</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="n">ipd.Rproj</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="w">  </span><span class="n">script.R</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="w">    </span><span class="n">documentation</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="w">      </span><span class="n">discussion.pdf</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="w">      </span><span class="n">getting_started.pdf</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="w">      </span><span class="n">script_reference.pdf</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="w">      </span><span class="n">script_reference.Rmd</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="w">      </span><span class="n">variables.csv</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="w">    </span><span class="n">outputs</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="w">      </span><span class="n">breaks_by_indicator.csv</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="w">      </span><span class="n">counts_by_indicator.csv</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="w">      </span><span class="n">ipd.csv</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="w">      </span><span class="n">ipd.dbf</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="w">      </span><span class="n">ipd.prj</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="w">      </span><span class="n">ipd.shp</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="w">      </span><span class="n">ipd.shx</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="w">      </span><span class="n">mean_by_county.csv</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a><span class="w">      </span><span class="n">summary_by_indicator.csv</span>
</span></code></pre></div>
<h1 id="setup">2. Setup</h1>
<h2 id="two_a">2a. Dependencies</h2>
<p>The following packages are required to run this script. If you don't have the packages, you'll get the warning <code>Error in library (&lt;name of package&gt;) : there is no package called '&lt;name of package&gt;'</code>, in which case you'll need to install the package before proceeding.</p>
<div class="language-r highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="nf">library</span><span class="p">(</span><span class="n">plyr</span><span class="p">);</span><span class="w"> </span><span class="nf">library</span><span class="p">(</span><span class="n">here</span><span class="p">);</span><span class="w"> </span><span class="nf">library</span><span class="p">(</span><span class="n">sf</span><span class="p">);</span><span class="w"> </span><span class="nf">library</span><span class="p">(</span><span class="n">summarytools</span><span class="p">);</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="nf">library</span><span class="p">(</span><span class="n">tidycensus</span><span class="p">);</span><span class="w"> </span><span class="nf">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">);</span><span class="w"> </span><span class="nf">library</span><span class="p">(</span><span class="n">tigris</span><span class="p">);</span><span class="w"> </span><span class="nf">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">);</span><span class="w"> </span><span class="nf">library</span><span class="p">(</span><span class="n">descr</span><span class="p">);</span>
</span></code></pre></div>
<h2 id="two_b">2b. Fields</h2>
<p>The base information we need for IPD analysis are universes, counts, and percentages for nine indicators at the census tract level. For each indicator, the table below shows the indicator name, its abbreviation used in the script, its universe, its count, and its percentage field if applicable. Find a list of histoic variables below:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Field</th>
<th style="text-align: center;">year_2015</th>
<th style="text-align: center;">year_2016</th>
<th style="text-align: center;">year_2017</th>
<th style="text-align: center;">year_2018</th>
<th style="text-align: center;">year_2019</th>
<th style="text-align: center;">year_2020</th>
<th style="text-align: right;">year_2021</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">disabled_universe</td>
<td style="text-align: center;">S1810_C01_001</td>
<td style="text-align: center;">S1810_C01_001</td>
<td style="text-align: center;">S1810_C01_001</td>
<td style="text-align: center;">S1810_C01_001</td>
<td style="text-align: center;">S1810_C01_001</td>
<td style="text-align: center;">S1810_C01_001</td>
<td style="text-align: right;">S1810_C01_001</td>
</tr>
<tr>
<td style="text-align: left;">disabled_count</td>
<td style="text-align: center;">S1810_C02_001</td>
<td style="text-align: center;">S1810_C02_001</td>
<td style="text-align: center;">S1810_C02_001</td>
<td style="text-align: center;">S1810_C02_001</td>
<td style="text-align: center;">S1810_C02_001</td>
<td style="text-align: center;">S1810_C02_001</td>
<td style="text-align: right;">S1810_C02_001</td>
</tr>
<tr>
<td style="text-align: left;">disabled_percent</td>
<td style="text-align: center;">S1810_C03_001</td>
<td style="text-align: center;">S1810_C03_001</td>
<td style="text-align: center;">S1810_C03_001</td>
<td style="text-align: center;">S1810_C03_001</td>
<td style="text-align: center;">S1810_C03_001</td>
<td style="text-align: center;">S1810_C03_001</td>
<td style="text-align: right;">S1810_C03_001</td>
</tr>
<tr>
<td style="text-align: left;">ethnic_minority_universe</td>
<td style="text-align: center;">B03002_001</td>
<td style="text-align: center;">B03002_001</td>
<td style="text-align: center;">B03002_001</td>
<td style="text-align: center;">B03002_001</td>
<td style="text-align: center;">B03002_001</td>
<td style="text-align: center;">B03002_001</td>
<td style="text-align: right;">B03002_001</td>
</tr>
<tr>
<td style="text-align: left;">ethnic_minority_count</td>
<td style="text-align: center;">B03002_012</td>
<td style="text-align: center;">B03002_012</td>
<td style="text-align: center;">B03002_012</td>
<td style="text-align: center;">B03002_012</td>
<td style="text-align: center;">B03002_012</td>
<td style="text-align: center;">B03002_012</td>
<td style="text-align: right;">B03002_012</td>
</tr>
<tr>
<td style="text-align: left;">ethnic_minority_percent</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr>
<td style="text-align: left;">female_universe</td>
<td style="text-align: center;">S0101_C01_001</td>
<td style="text-align: center;">S0101_C01_001</td>
<td style="text-align: center;">S0101_C01_001</td>
<td style="text-align: center;">S0101_C01_001</td>
<td style="text-align: center;">S0101_C01_001</td>
<td style="text-align: center;">S0101_C01_001</td>
<td style="text-align: right;">S0101_C01_001</td>
</tr>
<tr>
<td style="text-align: left;">female_count</td>
<td style="text-align: center;">S0101_C03_001</td>
<td style="text-align: center;">S0101_C03_001</td>
<td style="text-align: center;">S0101_C05_001</td>
<td style="text-align: center;">S0101_C05_001</td>
<td style="text-align: center;">S0101_C05_001</td>
<td style="text-align: center;">S0101_C05_001</td>
<td style="text-align: right;">S0101_C05_001</td>
</tr>
<tr>
<td style="text-align: left;">female_percent</td>
<td style="text-align: center;">DP05_0003PE</td>
<td style="text-align: center;">DP05_0003PE</td>
<td style="text-align: center;">DP05_0003PE</td>
<td style="text-align: center;">DP05_0003PE</td>
<td style="text-align: center;">DP05_0003PE</td>
<td style="text-align: center;">DP05_0003PE</td>
<td style="text-align: right;">DP05_0003PE</td>
</tr>
<tr>
<td style="text-align: left;">foreign_born_universe</td>
<td style="text-align: center;">B05012_001</td>
<td style="text-align: center;">B05012_001</td>
<td style="text-align: center;">B05012_001</td>
<td style="text-align: center;">B05012_001</td>
<td style="text-align: center;">B05012_001</td>
<td style="text-align: center;">B05012_001</td>
<td style="text-align: right;">B05012_001</td>
</tr>
<tr>
<td style="text-align: left;">foreign_born_count</td>
<td style="text-align: center;">B05012_003</td>
<td style="text-align: center;">B05012_003</td>
<td style="text-align: center;">B05012_003</td>
<td style="text-align: center;">B05012_003</td>
<td style="text-align: center;">B05012_003</td>
<td style="text-align: center;">B05012_003</td>
<td style="text-align: right;">B05012_003</td>
</tr>
<tr>
<td style="text-align: left;">foreign_born_percent</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr>
<td style="text-align: left;">limited_english_proficiency_universe</td>
<td style="text-align: center;">S1601_C01_001</td>
<td style="text-align: center;">S1601_C01_001</td>
<td style="text-align: center;">S1601_C01_001</td>
<td style="text-align: center;">S1601_C01_001</td>
<td style="text-align: center;">S1601_C01_001</td>
<td style="text-align: center;">S1601_C01_001</td>
<td style="text-align: right;">S1601_C01_001</td>
</tr>
<tr>
<td style="text-align: left;">limited_english_proficiency_count</td>
<td style="text-align: center;">S1601_C05_001</td>
<td style="text-align: center;">S1601_C05_001</td>
<td style="text-align: center;">S1601_C05_001</td>
<td style="text-align: center;">S1601_C05_001</td>
<td style="text-align: center;">S1601_C05_001</td>
<td style="text-align: center;">S1601_C05_001</td>
<td style="text-align: right;">S1601_C05_001</td>
</tr>
<tr>
<td style="text-align: left;">limited_english_proficiency_percent</td>
<td style="text-align: center;">S1601_C06_001</td>
<td style="text-align: center;">S1601_C06_001</td>
<td style="text-align: center;">S1601_C06_001</td>
<td style="text-align: center;">S1601_C06_001</td>
<td style="text-align: center;">S1601_C06_001</td>
<td style="text-align: center;">S1601_C06_001</td>
<td style="text-align: right;">S1601_C06_001</td>
</tr>
<tr>
<td style="text-align: left;">low_income_universe</td>
<td style="text-align: center;">S1701_C01_001</td>
<td style="text-align: center;">S1701_C01_001</td>
<td style="text-align: center;">S1701_C01_001</td>
<td style="text-align: center;">S1701_C01_001</td>
<td style="text-align: center;">S1701_C01_001</td>
<td style="text-align: center;">S1701_C01_001</td>
<td style="text-align: right;">S1701_C01_001</td>
</tr>
<tr>
<td style="text-align: left;">low_income_count</td>
<td style="text-align: center;">S1701_C01_042</td>
<td style="text-align: center;">S1701_C01_042</td>
<td style="text-align: center;">S1701_C01_042</td>
<td style="text-align: center;">S1701_C01_042</td>
<td style="text-align: center;">S1701_C01_042</td>
<td style="text-align: center;">S1701_C01_042</td>
<td style="text-align: right;">S1701_C01_042</td>
</tr>
<tr>
<td style="text-align: left;">low_income_percent</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr>
<td style="text-align: left;">older_adults_universe</td>
<td style="text-align: center;">S0101_C01_001</td>
<td style="text-align: center;">S0101_C01_001</td>
<td style="text-align: center;">S0101_C01_001</td>
<td style="text-align: center;">S0101_C01_001</td>
<td style="text-align: center;">S0101_C01_001</td>
<td style="text-align: center;">S0101_C01_001</td>
<td style="text-align: right;">S0101_C01_001</td>
</tr>
<tr>
<td style="text-align: left;">older_adults_count</td>
<td style="text-align: center;">DP05_0025E</td>
<td style="text-align: center;">DP05_0025E</td>
<td style="text-align: center;">DP05_0025E</td>
<td style="text-align: center;">S0101_C01_030</td>
<td style="text-align: center;">S0101_C01_030</td>
<td style="text-align: center;">S0101_C01_030</td>
<td style="text-align: right;">S0101_C01_030</td>
</tr>
<tr>
<td style="text-align: left;">older_adults_percent</td>
<td style="text-align: center;">S0101_C02_028</td>
<td style="text-align: center;">S0101_C02_028</td>
<td style="text-align: center;">S0101_C02_030</td>
<td style="text-align: center;">S0101_C02_030</td>
<td style="text-align: center;">S0101_C02_030</td>
<td style="text-align: center;">S0101_C02_030</td>
<td style="text-align: right;">S0101_C02_030</td>
</tr>
<tr>
<td style="text-align: left;">racial_minority_universe</td>
<td style="text-align: center;">B02001_001</td>
<td style="text-align: center;">B02001_001</td>
<td style="text-align: center;">B02001_001</td>
<td style="text-align: center;">B02001_001</td>
<td style="text-align: center;">B02001_001</td>
<td style="text-align: center;">B02001_001</td>
<td style="text-align: right;">B02001_001</td>
</tr>
<tr>
<td style="text-align: left;">racial_minority_count</td>
<td style="text-align: center;">B02001_002</td>
<td style="text-align: center;">B02001_002</td>
<td style="text-align: center;">B02001_002</td>
<td style="text-align: center;">B02001_002</td>
<td style="text-align: center;">B02001_002</td>
<td style="text-align: center;">B02001_002</td>
<td style="text-align: right;">B02001_002</td>
</tr>
<tr>
<td style="text-align: left;">racial_minority_percent</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr>
<td style="text-align: left;">youth_universe</td>
<td style="text-align: center;">B03002_001</td>
<td style="text-align: center;">B03002_001</td>
<td style="text-align: center;">B03002_001</td>
<td style="text-align: center;">B03002_001</td>
<td style="text-align: center;">B03002_001</td>
<td style="text-align: center;">B03002_001</td>
<td style="text-align: right;"></td>
</tr>
</tbody>
</table>
<p>Some percentage fields are empty. This is okay: we will compute the percentages when they are not directly available from the ACS.</p>
<p>Note that variable B02001_002 ("Estimate; Total: - White alone") is listed as the count for Racial Minority. This is a mathematical shortcut: otherwise, we would need to add several subfields to compute the same estimate. The desired count is B02001_001 (Universe) <span class="arithmatex">\(-\)</span> B02001_002 ("Estimate; Total: - White alone"). The subtraction is computed after download in Section 5d.i., making a correct estimate and an incorrect MOE. The correct MOE for the count, as calculated in Section 4, will be appended later.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Indicator</th>
<th style="text-align: center;">Abbreviation</th>
<th style="text-align: center;">Universe</th>
<th style="text-align: center;">Count</th>
<th style="text-align: center;">Percentage</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Disabled</td>
<td style="text-align: center;">D</td>
<td style="text-align: center;">S1810_C01_001</td>
<td style="text-align: center;">S1810_C02_001</td>
<td style="text-align: center;">S1810_C03_001</td>
</tr>
<tr>
<td style="text-align: left;">Ethnic Minority</td>
<td style="text-align: center;">EM</td>
<td style="text-align: center;">B03002_001</td>
<td style="text-align: center;">B03002_012</td>
<td style="text-align: center;">N/A</td>
</tr>
<tr>
<td style="text-align: left;">Female</td>
<td style="text-align: center;">F</td>
<td style="text-align: center;">S0101_C01_001</td>
<td style="text-align: center;">S0101_C05_001</td>
<td style="text-align: center;">DP05_0003PE</td>
</tr>
<tr>
<td style="text-align: left;">Foreign-Born</td>
<td style="text-align: center;">FB</td>
<td style="text-align: center;">B05012_001</td>
<td style="text-align: center;">B05012_003</td>
<td style="text-align: center;">N/A</td>
</tr>
<tr>
<td style="text-align: left;">Limited English Proficiency</td>
<td style="text-align: center;">LEP</td>
<td style="text-align: center;">S1601_C01_001</td>
<td style="text-align: center;">S1601_C05_001</td>
<td style="text-align: center;">S1601_C06_001</td>
</tr>
<tr>
<td style="text-align: left;">Low-Income</td>
<td style="text-align: center;">LI</td>
<td style="text-align: center;">S1701_C01_001</td>
<td style="text-align: center;">S1701_C01_042</td>
<td style="text-align: center;">N/A</td>
</tr>
<tr>
<td style="text-align: left;">Older Adults</td>
<td style="text-align: center;">OA</td>
<td style="text-align: center;">S0101_C01_001</td>
<td style="text-align: center;">S0101_C01_030</td>
<td style="text-align: center;">S0101_C02_030</td>
</tr>
<tr>
<td style="text-align: left;">Racial Minority</td>
<td style="text-align: center;">RM</td>
<td style="text-align: center;">B02001_001</td>
<td style="text-align: center;">B02001_002</td>
<td style="text-align: center;">N/A</td>
</tr>
<tr>
<td style="text-align: left;">Youth</td>
<td style="text-align: center;">Y</td>
<td style="text-align: center;">B03002_001</td>
<td style="text-align: center;">B09001_001</td>
<td style="text-align: center;">N/A</td>
</tr>
</tbody>
</table>
<p><br></p>
<p>While it's quicker to embed the names of the desired columns into the code, fields are explicitly spelled out in this script. This is a purposeful design choice. The user should check that the field names point to the correct API request with every IPD update. The best way to check the field names is to visit <a href="https://www.census.gov/developers/">Census Developers</a> and select the corresponding API. For a history of the ACS variables used in IPD 2015, 2016, and 2017, see <code>variables.csv</code> in the <code>documentation</code> folder or in the table above.</p>
<p><br></p>
<h2 id="two_c">2c. Year</h2>
<p>The data download year.</p>
<div class="language-r highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="n">ipd_year</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">2017</span>
</span></code></pre></div>
<p><br></p>
<h2 id="two_d">2d. States</h2>
<p>The data download state or states. Use the two-character text abbreviation.
<br></p>
<div class="language-r highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="n">ipd_states</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;NJ&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;PA&quot;</span><span class="p">)</span>
</span></code></pre></div>
<p><br></p>
<h2 id="two_e">2e. Counties</h2>
<p>The counties in your study area. Use five-digit characters concatenating the two-digit state and three-digit county GEOID's.
<br></p>
<div class="language-r highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="n">ipd_counties</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;34005&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;34007&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;34015&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;34021&quot;</span><span class="p">,</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="w">                  </span><span class="s">&quot;42017&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;42029&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;42045&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;42091&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;42101&quot;</span><span class="p">)</span>
</span></code></pre></div>
<p><br></p>
<h2 id="two_f">2f. Census API Key</h2>
<p>Placeholder if you have never installed an API key before. If this is your first time accessing the Census API using <code>R</code>, see <a href="https://github.com/dvrpc/ipd/#readme">README.md</a>
<br></p>
<div class="language-r highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="c1"># Census API Key</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="nf">census_api_key</span><span class="p">(</span><span class="s">&quot;YOUR API KEY GOES HERE&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">install</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span>
</span></code></pre></div>
<h1 id="the-typical-user-should-not-have-to-edit-anything-below-this-point"><em>THE TYPICAL USER SHOULD NOT HAVE TO EDIT ANYTHING BELOW THIS POINT.</em></h1>
<h2 id="two_g">2g. Functions</h2>
<p>Load custom functions.</p>
<h3 id="two_g_i">2g.i. Override <code>base</code> and <code>stats</code> function defaults</h3>
<p>A time-saver so that it's not required to call <code>na.rm = TRUE</code> every time common functions are called.
<br></p>
<div class="language-r highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="n">min</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="kc">...</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="w">  </span><span class="n">base</span><span class="o">::</span><span class="nf">min</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="kc">...</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">na.rm</span><span class="p">)</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="p">}</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="n">mean</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="kc">...</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="w">  </span><span class="n">base</span><span class="o">::</span><span class="nf">mean</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="kc">...</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">na.rm</span><span class="p">)</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="p">}</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="n">sd</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="kc">...</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="w">  </span><span class="n">stats</span><span class="o">::</span><span class="nf">sd</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="kc">...</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">na.rm</span><span class="p">)</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="p">}</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="n">max</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="kc">...</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="w">  </span><span class="n">base</span><span class="o">::</span><span class="nf">max</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="kc">...</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">na.rm</span><span class="p">)</span>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="two_g_ii">2g.ii. Create custom half-standard deviation breaks</h3>
<p>For a given vector of numbers <code>x</code> and a number of bins <code>i</code>, <code>st_dev_breaks</code> computes the bin breaks starting at <code>$-0.5 \cdot st dev$</code> and <code>$0.5 \cdot st dev$</code>. For the purposes of IPD analysis, <code>i = 5</code>, and <code>st_dev_breaks</code> calculates the minimum, <code>$-1.5 \cdot st dev$</code>, <code>$-0.5 \cdot st dev$</code>, <code>$0.5 \cdot st dev$</code>, <code>$1.5 \cdot st dev$</code>, and maximum values. These values are later used to slice the vector into five bins.</p>
<h3 id="two_g_iii">2g.iii. <em>Exception</em></h3>
<p>All minima are coerced to equal zero. If the first bin break (<code>$-1.5 \cdot st dev$</code>) is negative, as happens when the data has a large spread and therefore a large standard deviation, then this bin break is coerced to equal 0.1. In these cases, only estimates of 0 percent will be placed in the bottom bin.
<br></p>
<div class="language-r highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="n">st_dev_breaks</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">){</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="w">  </span><span class="n">half_st_dev_count</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">-1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">rev</span><span class="p">(</span><span class="nf">seq</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)),</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="w">                         </span><span class="nf">seq</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">))</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="w">  </span><span class="nf">if</span><span class="p">((</span><span class="n">i</span><span class="w"> </span><span class="o">%%</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="w">    </span><span class="n">half_st_dev_breaks</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sapply</span><span class="p">(</span><span class="n">half_st_dev_count</span><span class="p">,</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="w">                                 </span><span class="nf">function</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="m">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">sd</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">mean</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="w">    </span><span class="n">half_st_dev_breaks</span><span class="p">[[</span><span class="m">1</span><span class="p">]]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="w">    </span><span class="n">half_st_dev_breaks</span><span class="p">[[</span><span class="m">2</span><span class="p">]]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">ifelse</span><span class="p">(</span><span class="n">half_st_dev_breaks</span><span class="p">[[</span><span class="m">2</span><span class="p">]]</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">0</span><span class="p">,</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="w">                                      </span><span class="m">0.1</span><span class="p">,</span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="w">                                      </span><span class="n">half_st_dev_breaks</span><span class="p">[[</span><span class="m">2</span><span class="p">]])</span>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a><span class="w">    </span><span class="n">half_st_dev_breaks</span><span class="p">[[</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="p">]]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">ifelse</span><span class="p">(</span><span class="nf">max</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">half_st_dev_breaks</span><span class="p">[[</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="p">]],</span>
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a><span class="w">                                          </span><span class="nf">max</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="w"> </span><span class="n">half_st_dev_breaks</span><span class="p">[[</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="p">]])</span>
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="n">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a><span class="w">    </span><span class="n">half_st_dev_breaks</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NA</span>
</span><span id="__span-7-15"><a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-7-16"><a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a><span class="w">  </span><span class="nf">return</span><span class="p">(</span><span class="n">half_st_dev_breaks</span><span class="p">)</span>
</span><span id="__span-7-17"><a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="two_g_iv">2g.iv. Move column or vector of columns to last position</h3>
<p>The requested schema for IPD data export renames and places all relevant universes in the final columns of the dataset. <code>move_last</code> moves a column or vector of column names to the last position(s) in a data frame. Further reordering is done in the final web application.
<br></p>
<div class="language-r highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="n">move_last</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">last_col</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="w">  </span><span class="nf">match</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="nf">setdiff</span><span class="p">(</span><span class="nf">names</span><span class="p">(</span><span class="n">df</span><span class="p">),</span><span class="w"> </span><span class="n">last_col</span><span class="p">),</span><span class="w"> </span><span class="n">last_col</span><span class="p">),</span><span class="w"> </span><span class="nf">names</span><span class="p">(</span><span class="n">df</span><span class="p">))</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="two_g_v">2g.v. Summarize data</h3>
<p><code>description</code> tailors the exports from <code>summarytools::descr</code> to create summary tables with the requested fields. <code>$0.5 \cdot st dev$</code> is returned after <code>$stdev$</code>.
<br></p>
<div class="language-r highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="n">description</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="w">  </span><span class="n">des</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">summarytools</span><span class="o">::</span><span class="nf">descr</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="w">                                        </span><span class="n">stats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;min&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;med&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;mean&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;sd&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;max&quot;</span><span class="p">)))</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="w">  </span><span class="n">des</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">des</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">],</span><span class="w"> </span><span class="n">des</span><span class="p">[</span><span class="m">4</span><span class="p">]</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">des</span><span class="p">[</span><span class="m">5</span><span class="p">])</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="w">  </span><span class="nf">return</span><span class="p">(</span><span class="n">des</span><span class="p">)</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="p">}</span>
</span></code></pre></div>
<h1 id="variance_replicate_table_download">3. Variance replicate table download</h1>
<p>The racial minority indicator is created by summing up several subgroups in ACS Table <code>B03002</code>. This means that the MOE for the count has to be computed. While the ACS has issued guidance on computing the MOE by aggregating subgroups, using the approximation formula can artificially deflate the derived MOE. Variance replicate tables are used instead to account for covariance and compute a more accurate MOE. The MOE computed from variance replicates is substituted in for the racial minority count MOE in Section 5d.ii.</p>
<p>See the Census Bureau's <a href="https://www.census.gov/programs-surveys/acs/technical-documentation/variance-tables.html">Variance Replicate Tables Documentation</a> for additional guidance on working with variance replicates.</p>
<h2 id="three_a">3a. Download variance replicates from Census website</h2>
<p>Download, unzip, and read variance replicate tables for Table <code>B02001</code>. Results are combined into a single table called <code>var_rep</code>.
<br></p>
<div class="language-r highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="n">ipd_states_numeric</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">fips_codes</span><span class="w"> </span><span class="o">%&gt;%</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="w">  </span><span class="nf">filter</span><span class="p">(</span><span class="n">state</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">ipd_states</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="w">  </span><span class="nf">select</span><span class="p">(</span><span class="n">state_code</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">distinct</span><span class="p">(</span><span class="n">.</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">pull</span><span class="p">(</span><span class="n">.</span><span class="p">)</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="n">var_rep</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NULL</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="nf">for </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">ipd_states</span><span class="p">)){</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="w">  </span><span class="n">url</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">paste0</span><span class="p">(</span><span class="s">&quot;https://www2.census.gov/programs-surveys/acs/replicate_estimates/&quot;</span><span class="p">,</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="w">                </span><span class="n">ipd_year</span><span class="p">,</span>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="w">                </span><span class="s">&quot;/data/5-year/140/B02001_&quot;</span><span class="p">,</span>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="w">                </span><span class="n">ipd_states_numeric</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a><span class="w">                </span><span class="s">&quot;.csv.zip&quot;</span><span class="p">)</span>
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a><span class="w">  </span><span class="n">temp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">tempfile</span><span class="p">()</span>
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a><span class="w">  </span><span class="nf">download.file</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="w"> </span><span class="n">temp</span><span class="p">)</span>
</span><span id="__span-10-14"><a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a><span class="w">  </span><span class="n">var_rep_i</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">read.csv</span><span class="p">(</span><span class="nf">unzip</span><span class="p">(</span><span class="n">temp</span><span class="p">))</span>
</span><span id="__span-10-15"><a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a><span class="w">  </span><span class="n">var_rep</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dplyr</span><span class="o">::</span><span class="nf">bind_rows</span><span class="p">(</span><span class="n">var_rep</span><span class="p">,</span><span class="w"> </span><span class="n">var_rep_i</span><span class="p">)</span>
</span><span id="__span-10-16"><a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a><span class="p">}</span>
</span></code></pre></div>
<h2 id="three_b">3b. Combine and format downloads</h2>
<p>Subset <code>var_rep</code> for the study area defined in <code>ipd_counties</code> and extract the necessary subgroups.
<br></p>
<div class="language-r highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="n">var_rep</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">var_rep</span><span class="w"> </span><span class="o">%&gt;%</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="w">  </span><span class="nf">mutate_at</span><span class="p">(</span><span class="nf">vars</span><span class="p">(</span><span class="n">GEOID</span><span class="p">),</span><span class="w"> </span><span class="o">~</span><span class="p">(</span><span class="nf">str_sub</span><span class="p">(</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="m">18</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="w">  </span><span class="nf">filter</span><span class="p">(</span><span class="nf">str_sub</span><span class="p">(</span><span class="n">GEOID</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">ipd_counties</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="w">  </span><span class="nf">select</span><span class="p">(</span><span class="o">-</span><span class="n">TBLID</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">NAME</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">ORDER</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">MOE</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">CME</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">SE</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="w">  </span><span class="nf">filter</span><span class="p">(</span><span class="n">TITLE</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;Black or African American alone&quot;</span><span class="p">,</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="w">                      </span><span class="s">&quot;American Indian and Alaska Native alone&quot;</span><span class="p">,</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="w">                      </span><span class="s">&quot;Asian alone&quot;</span><span class="p">,</span>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="w">                      </span><span class="s">&quot;Native Hawaiian and Other Pacific Islander alone&quot;</span><span class="p">,</span>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="w">                      </span><span class="s">&quot;Some other race alone&quot;</span><span class="p">,</span>
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a><span class="w">                      </span><span class="s">&quot;Two or more races:&quot;</span><span class="p">))</span>
</span></code></pre></div>
<h1 id="variance_replicate_table_processing">4. Variance replicate table processing</h1>
<h2 id="four_a">4a. Compute racial minority count MOE</h2>
<p>Add up the racial minority counts into a single count per census tract for the estimate and 80 variance replicates. Separate the resulting data frame into estimates and variance replicates.
<br></p>
<div class="language-r highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="n">num</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">var_rep</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="w">  </span><span class="nf">group_by</span><span class="p">(</span><span class="n">GEOID</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="w">  </span><span class="nf">summarize_if</span><span class="p">(</span><span class="n">is.numeric</span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">.</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="w">  </span><span class="nf">select</span><span class="p">(</span><span class="o">-</span><span class="n">GEOID</span><span class="p">)</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="n">estim</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">num</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">select</span><span class="p">(</span><span class="n">ESTIMATE</span><span class="p">)</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="n">individual_replicate</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">num</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">select</span><span class="p">(</span><span class="o">-</span><span class="n">ESTIMATE</span><span class="p">)</span>
</span></code></pre></div>
<p>Compute the variance replicate for the count. GEOIDs are stored as <code>id</code> to be re-appended to the MOEs after they are calculated.
<br></p>
<div class="language-r highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="n">id</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">var_rep</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">select</span><span class="p">(</span><span class="n">GEOID</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">distinct</span><span class="p">(</span><span class="n">.</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">pull</span><span class="p">(</span><span class="n">.</span><span class="p">)</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="n">sqdiff_fun</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">v</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="m">2</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="n">sqdiff</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">mapply</span><span class="p">(</span><span class="n">sqdiff_fun</span><span class="p">,</span><span class="w"> </span><span class="n">individual_replicate</span><span class="p">,</span><span class="w"> </span><span class="n">estim</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="n">sum_sqdiff</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sapply</span><span class="p">(</span><span class="n">sqdiff</span><span class="p">,</span><span class="w"> </span><span class="n">sum</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="n">variance</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0.05</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sum_sqdiff</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="n">moe</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">variance</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">1.645</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">)</span>
</span></code></pre></div>
<h2 id="four_b">4b. Save results</h2>
<p>Save the racial minority MOE.
<br></p>
<div class="language-r highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="n">rm_moe</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">cbind</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">moe</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="w">  </span><span class="nf">as_tibble</span><span class="p">(</span><span class="n">.</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="w">  </span><span class="nf">rename</span><span class="p">(</span><span class="n">GEOID20</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">RM_CntMOE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">moe</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="w">  </span><span class="nf">mutate_at</span><span class="p">(</span><span class="nf">vars</span><span class="p">(</span><span class="n">RM_CntMOE</span><span class="p">),</span><span class="w"> </span><span class="n">as.numeric</span><span class="p">)</span>
</span></code></pre></div>
<h1 id="acs_estimates_download">5. ACS estimates download</h1>
<h2 id="five_a">5a. Fields</h2>
<p>Fields for downloads from the ACS API were discussed in Section 2b.</p>
<h2 id="five_b">5b. Download counts and universes from Census API</h2>
<p>Download counts and percentages for each of IPD's nine indicators. Note that the download is for all census tracts in <code>ipd_states</code>.</p>
<p>Input data for IPD comes from ACS Subject Tables, Detailed Tables, and Data Profiles. While one can request all the fields for Subject Tables in one batch, mixing requests for two or more different types of tables will result in failure. For this reason, the counts and universe fields supplied by the user in Section 2b are evaluated for their contents and split into three batches: <code>s_counts</code> for Subject Tables, <code>d_counts</code> for Detailed Tables, and <code>dp_counts</code> for Data Profiles.</p>
<p>The chunk below zips the user-defined calls from the API with the output abbreviations into a data frame called <code>counts_calls</code> and separates the calls into three batches.
<br></p>
<div class="language-r highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="n">counts</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">disabled_count</span><span class="p">,</span><span class="w"> </span><span class="n">disabled_universe</span><span class="p">,</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="w">            </span><span class="n">ethnic_minority_count</span><span class="p">,</span><span class="w"> </span><span class="n">ethnic_minority_universe</span><span class="p">,</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="w">            </span><span class="n">female_count</span><span class="p">,</span><span class="w"> </span><span class="n">female_universe</span><span class="p">,</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="w">            </span><span class="n">foreign_born_count</span><span class="p">,</span><span class="w"> </span><span class="n">foreign_born_universe</span><span class="p">,</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="w">            </span><span class="n">limited_english_proficiency_count</span><span class="p">,</span><span class="w"> </span><span class="n">limited_english_proficiency_universe</span><span class="p">,</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="w">            </span><span class="n">low_income_count</span><span class="p">,</span><span class="w"> </span><span class="n">low_income_universe</span><span class="p">,</span>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="w">            </span><span class="n">older_adults_count</span><span class="p">,</span><span class="w"> </span><span class="n">older_adults_universe</span><span class="p">,</span>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="w">            </span><span class="n">racial_minority_count</span><span class="p">,</span><span class="w"> </span><span class="n">racial_minority_universe</span><span class="p">,</span>
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a><span class="w">            </span><span class="n">youth_count</span><span class="p">,</span><span class="w"> </span><span class="n">youth_universe</span><span class="p">)</span>
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a><span class="n">counts_ids</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;D_C&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;D_U&quot;</span><span class="p">,</span><span class="w"> </span>
</span><span id="__span-15-11"><a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a><span class="w">                </span><span class="s">&quot;EM_C&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;EM_U&quot;</span><span class="p">,</span>
</span><span id="__span-15-12"><a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a><span class="w">                </span><span class="s">&quot;F_C&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;F_U&quot;</span><span class="p">,</span>
</span><span id="__span-15-13"><a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a><span class="w">                </span><span class="s">&quot;FB_C&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;FB_U&quot;</span><span class="p">,</span>
</span><span id="__span-15-14"><a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a><span class="w">                </span><span class="s">&quot;LEP_C&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;LEP_U&quot;</span><span class="p">,</span><span class="w"> </span>
</span><span id="__span-15-15"><a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a><span class="w">                </span><span class="s">&quot;LI_C&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;LI_U&quot;</span><span class="p">,</span>
</span><span id="__span-15-16"><a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a><span class="w">                </span><span class="s">&quot;OA_C&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;OA_U&quot;</span><span class="p">,</span><span class="w"> </span>
</span><span id="__span-15-17"><a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a><span class="w">                </span><span class="s">&quot;RM_C&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;RM_U&quot;</span><span class="p">,</span><span class="w"> </span>
</span><span id="__span-15-18"><a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a><span class="w">                </span><span class="s">&quot;Y_C&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Y_U&quot;</span><span class="p">)</span>
</span><span id="__span-15-19"><a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a>
</span><span id="__span-15-20"><a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a><span class="c1"># Zip count API variables and their appropriate abbreviations together</span>
</span><span id="__span-15-21"><a id="__codelineno-15-21" name="__codelineno-15-21" href="#__codelineno-15-21"></a><span class="n">counts_calls</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">tibble</span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">counts_ids</span><span class="p">,</span><span class="w"> </span><span class="n">api</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">counts</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
</span><span id="__span-15-22"><a id="__codelineno-15-22" name="__codelineno-15-22" href="#__codelineno-15-22"></a><span class="w">  </span><span class="nf">drop_na</span><span class="p">(</span><span class="n">.</span><span class="p">)</span>
</span><span id="__span-15-23"><a id="__codelineno-15-23" name="__codelineno-15-23" href="#__codelineno-15-23"></a>
</span><span id="__span-15-24"><a id="__codelineno-15-24" name="__codelineno-15-24" href="#__codelineno-15-24"></a><span class="c1"># Separate into different types of API requests</span>
</span><span id="__span-15-25"><a id="__codelineno-15-25" name="__codelineno-15-25" href="#__codelineno-15-25"></a><span class="n">s_calls</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">counts_calls</span><span class="w"> </span><span class="o">%&gt;%</span>
</span><span id="__span-15-26"><a id="__codelineno-15-26" name="__codelineno-15-26" href="#__codelineno-15-26"></a><span class="w">  </span><span class="nf">filter</span><span class="p">(</span><span class="nf">str_sub</span><span class="p">(</span><span class="n">api</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;S&quot;</span><span class="p">)</span><span class="w">  </span><span class="c1"># Summary Tables</span>
</span><span id="__span-15-27"><a id="__codelineno-15-27" name="__codelineno-15-27" href="#__codelineno-15-27"></a><span class="n">d_calls</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">counts_calls</span><span class="w"> </span><span class="o">%&gt;%</span>
</span><span id="__span-15-28"><a id="__codelineno-15-28" name="__codelineno-15-28" href="#__codelineno-15-28"></a><span class="w">  </span><span class="nf">filter</span><span class="p">(</span><span class="nf">str_sub</span><span class="p">(</span><span class="n">api</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;B&quot;</span><span class="p">)</span><span class="w">  </span><span class="c1"># Detailed Tables</span>
</span><span id="__span-15-29"><a id="__codelineno-15-29" name="__codelineno-15-29" href="#__codelineno-15-29"></a><span class="n">dp_calls</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">counts_calls</span><span class="w"> </span><span class="o">%&gt;%</span>
</span><span id="__span-15-30"><a id="__codelineno-15-30" name="__codelineno-15-30" href="#__codelineno-15-30"></a><span class="w">  </span><span class="nf">filter</span><span class="p">(</span><span class="nf">str_sub</span><span class="p">(</span><span class="n">api</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;D&quot;</span><span class="p">)</span><span class="w">  </span><span class="c1"># Data Profile</span>
</span></code></pre></div>
<p>API calls are made separately for ACS Subject Tables, Detailed Tables, and Data Profiles and appended to <code>dl_counts</code>. Sometimes there are no requests for an ACS table type; in these situations, the script bypasses a download attempt. Then, information from <code>counts_calls</code> is used to rename the downloads to the appropriate abbreviation.
Please note that ACS surveys 2019 and before make use of the GEOID10 variable.
<br></p>
<div class="language-r highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="n">dl_counts</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NULL</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="nf">if</span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">s_calls</span><span class="o">$</span><span class="n">id</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0</span><span class="p">)){</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="w">  </span><span class="n">s_counts</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">get_acs</span><span class="p">(</span><span class="n">geography</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;tract&quot;</span><span class="p">,</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="w">                      </span><span class="n">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ipd_states</span><span class="p">,</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="w">                      </span><span class="n">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;wide&quot;</span><span class="p">,</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="w">                      </span><span class="n">year</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ipd_year</span><span class="p">,</span>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="w">                      </span><span class="n">variables</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s_calls</span><span class="o">$</span><span class="n">api</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="w">    </span><span class="nf">select</span><span class="p">(</span><span class="o">-</span><span class="n">NAME</span><span class="p">)</span>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a><span class="w">  </span><span class="n">dl_counts</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">bind_cols</span><span class="p">(</span><span class="n">dl_counts</span><span class="p">,</span><span class="w"> </span><span class="n">s_counts</span><span class="p">)</span>
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a><span class="p">}</span>
</span><span id="__span-16-12"><a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a>
</span><span id="__span-16-13"><a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a><span class="nf">if</span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">d_calls</span><span class="o">$</span><span class="n">id</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0</span><span class="p">)){</span>
</span><span id="__span-16-14"><a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a><span class="w">  </span><span class="n">d_counts</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">get_acs</span><span class="p">(</span><span class="n">geography</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;tract&quot;</span><span class="p">,</span>
</span><span id="__span-16-15"><a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a><span class="w">                      </span><span class="n">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ipd_states</span><span class="p">,</span>
</span><span id="__span-16-16"><a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a><span class="w">                      </span><span class="n">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;wide&quot;</span><span class="p">,</span>
</span><span id="__span-16-17"><a id="__codelineno-16-17" name="__codelineno-16-17" href="#__codelineno-16-17"></a><span class="w">                      </span><span class="n">year</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ipd_year</span><span class="p">,</span>
</span><span id="__span-16-18"><a id="__codelineno-16-18" name="__codelineno-16-18" href="#__codelineno-16-18"></a><span class="w">                      </span><span class="n">variables</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">d_calls</span><span class="o">$</span><span class="n">api</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
</span><span id="__span-16-19"><a id="__codelineno-16-19" name="__codelineno-16-19" href="#__codelineno-16-19"></a><span class="w">    </span><span class="nf">select</span><span class="p">(</span><span class="o">-</span><span class="n">NAME</span><span class="p">)</span>
</span><span id="__span-16-20"><a id="__codelineno-16-20" name="__codelineno-16-20" href="#__codelineno-16-20"></a><span class="w">  </span><span class="n">dl_counts</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">left_join</span><span class="p">(</span><span class="n">dl_counts</span><span class="p">,</span><span class="w"> </span><span class="n">d_counts</span><span class="p">)</span>
</span><span id="__span-16-21"><a id="__codelineno-16-21" name="__codelineno-16-21" href="#__codelineno-16-21"></a><span class="p">}</span>
</span><span id="__span-16-22"><a id="__codelineno-16-22" name="__codelineno-16-22" href="#__codelineno-16-22"></a>
</span><span id="__span-16-23"><a id="__codelineno-16-23" name="__codelineno-16-23" href="#__codelineno-16-23"></a><span class="nf">if</span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">dp_calls</span><span class="o">$</span><span class="n">id</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0</span><span class="p">)){</span>
</span><span id="__span-16-24"><a id="__codelineno-16-24" name="__codelineno-16-24" href="#__codelineno-16-24"></a><span class="w">  </span><span class="n">dp_counts</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">get_acs</span><span class="p">(</span><span class="n">geography</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;tract&quot;</span><span class="p">,</span>
</span><span id="__span-16-25"><a id="__codelineno-16-25" name="__codelineno-16-25" href="#__codelineno-16-25"></a><span class="w">                       </span><span class="n">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ipd_states</span><span class="p">,</span>
</span><span id="__span-16-26"><a id="__codelineno-16-26" name="__codelineno-16-26" href="#__codelineno-16-26"></a><span class="w">                       </span><span class="n">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;wide&quot;</span><span class="p">,</span>
</span><span id="__span-16-27"><a id="__codelineno-16-27" name="__codelineno-16-27" href="#__codelineno-16-27"></a><span class="w">                       </span><span class="n">year</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ipd_year</span><span class="p">,</span>
</span><span id="__span-16-28"><a id="__codelineno-16-28" name="__codelineno-16-28" href="#__codelineno-16-28"></a><span class="w">                       </span><span class="n">variables</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dp_calls</span><span class="o">$</span><span class="n">api</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
</span><span id="__span-16-29"><a id="__codelineno-16-29" name="__codelineno-16-29" href="#__codelineno-16-29"></a><span class="w">    </span><span class="nf">select</span><span class="p">(</span><span class="o">-</span><span class="n">NAME</span><span class="p">)</span>
</span><span id="__span-16-30"><a id="__codelineno-16-30" name="__codelineno-16-30" href="#__codelineno-16-30"></a><span class="w">  </span><span class="n">dl_counts</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">left_join</span><span class="p">(</span><span class="n">dl_counts</span><span class="p">,</span><span class="w"> </span><span class="n">dp_counts</span><span class="p">)</span>
</span><span id="__span-16-31"><a id="__codelineno-16-31" name="__codelineno-16-31" href="#__codelineno-16-31"></a><span class="p">}</span>
</span><span id="__span-16-32"><a id="__codelineno-16-32" name="__codelineno-16-32" href="#__codelineno-16-32"></a>
</span><span id="__span-16-33"><a id="__codelineno-16-33" name="__codelineno-16-33" href="#__codelineno-16-33"></a><span class="n">dl_counts</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dl_counts</span><span class="w"> </span><span class="o">%&gt;%</span>
</span><span id="__span-16-34"><a id="__codelineno-16-34" name="__codelineno-16-34" href="#__codelineno-16-34"></a><span class="w">  </span><span class="nf">rename</span><span class="p">(</span><span class="n">GEOID20</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GEOID</span><span class="p">)</span>
</span></code></pre></div>
<h3 id="five_b_i">5b.i. <em>Exception</em></h3>
<p>The API does not allow redundant downloads, so universes for Older Adults and Youth are duplicated after download. <code>duplicate_cols</code> identifies duplicate API calls, and <code>combined_rows</code> serves as a crosswalk to duplicate and rename fields.
<br></p>
<div class="language-r highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="n">duplicate_cols</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">counts_calls</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="w">  </span><span class="nf">group_by</span><span class="p">(</span><span class="n">api</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="w">  </span><span class="nf">filter</span><span class="p">(</span><span class="nf">n</span><span class="p">()</span><span class="o">&gt;</span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="w">  </span><span class="nf">summarize</span><span class="p">(</span><span class="n">orig</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">id</span><span class="p">[</span><span class="m">1</span><span class="p">],</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="w">            </span><span class="n">duplicator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">id</span><span class="p">[</span><span class="m">2</span><span class="p">])</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="n">e_paste</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="nf">paste0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;E&quot;</span><span class="p">)</span>
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><span class="n">m_paste</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="nf">paste0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;M&quot;</span><span class="p">)</span>
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a><span class="n">e_rows</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="n">duplicate_cols</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">e_paste</span><span class="p">)</span>
</span><span id="__span-17-10"><a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a><span class="n">m_rows</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="n">duplicate_cols</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">m_paste</span><span class="p">)</span>
</span><span id="__span-17-11"><a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a>
</span><span id="__span-17-12"><a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a><span class="n">combined_rows</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as_tibble</span><span class="p">(</span><span class="nf">rbind</span><span class="p">(</span><span class="n">e_rows</span><span class="p">,</span><span class="w"> </span><span class="n">m_rows</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
</span><span id="__span-17-13"><a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a><span class="w">  </span><span class="nf">mutate_all</span><span class="p">(</span><span class="n">as.character</span><span class="p">)</span>
</span><span id="__span-17-14"><a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a>
</span><span id="__span-17-15"><a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a><span class="nf">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">combined_rows</span><span class="o">$</span><span class="n">api</span><span class="p">)){</span>
</span><span id="__span-17-16"><a id="__codelineno-17-16" name="__codelineno-17-16" href="#__codelineno-17-16"></a><span class="w">  </span><span class="n">dl_counts</span><span class="p">[</span><span class="n">combined_rows</span><span class="o">$</span><span class="n">duplicator</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dl_counts</span><span class="p">[</span><span class="n">combined_rows</span><span class="o">$</span><span class="n">orig</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
</span><span id="__span-17-17"><a id="__codelineno-17-17" name="__codelineno-17-17" href="#__codelineno-17-17"></a><span class="p">}</span>
</span></code></pre></div>
<h2 id="five_c">5c. Download percentages from Census API</h2>
<p>Download percentage tables that are available for four of IPD's nine indicators. We will compute percentages and their associated MOEs for the rest of the dataset later. The procedure is identical to that described in Section 5b.
<br></p>
<div class="language-r highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="n">percs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">disabled_percent</span><span class="p">,</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="w">           </span><span class="n">ethnic_minority_percent</span><span class="p">,</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="w">           </span><span class="n">female_percent</span><span class="p">,</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="w">           </span><span class="n">foreign_born_percent</span><span class="p">,</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="w">           </span><span class="n">limited_english_proficiency_percent</span><span class="p">,</span>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="w">           </span><span class="n">low_income_percent</span><span class="p">,</span>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="w">           </span><span class="n">older_adults_percent</span><span class="p">,</span>
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a><span class="w">           </span><span class="n">racial_minority_percent</span><span class="p">,</span>
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a><span class="w">           </span><span class="n">youth_percent</span><span class="p">)</span>
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a>
</span><span id="__span-18-11"><a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a><span class="n">percs_ids</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;D_P&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;EM_P&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;F_P&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;FB_P&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;LEP_P&quot;</span><span class="p">,</span>
</span><span id="__span-18-12"><a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a><span class="w">               </span><span class="s">&quot;LI_P&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;OA_P&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;RM_P&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Y_P&quot;</span><span class="p">)</span>
</span><span id="__span-18-13"><a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a>
</span><span id="__span-18-14"><a id="__codelineno-18-14" name="__codelineno-18-14" href="#__codelineno-18-14"></a><span class="n">percs_calls</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">tibble</span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">percs_ids</span><span class="p">,</span><span class="w"> </span><span class="n">api</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">percs</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
</span><span id="__span-18-15"><a id="__codelineno-18-15" name="__codelineno-18-15" href="#__codelineno-18-15"></a><span class="w">  </span><span class="nf">drop_na</span><span class="p">(</span><span class="n">.</span><span class="p">)</span>
</span><span id="__span-18-16"><a id="__codelineno-18-16" name="__codelineno-18-16" href="#__codelineno-18-16"></a>
</span><span id="__span-18-17"><a id="__codelineno-18-17" name="__codelineno-18-17" href="#__codelineno-18-17"></a><span class="n">s_calls</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">percs_calls</span><span class="w"> </span><span class="o">%&gt;%</span>
</span><span id="__span-18-18"><a id="__codelineno-18-18" name="__codelineno-18-18" href="#__codelineno-18-18"></a><span class="w">  </span><span class="nf">filter</span><span class="p">(</span><span class="nf">str_sub</span><span class="p">(</span><span class="n">api</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;S&quot;</span><span class="p">)</span>
</span><span id="__span-18-19"><a id="__codelineno-18-19" name="__codelineno-18-19" href="#__codelineno-18-19"></a>
</span><span id="__span-18-20"><a id="__codelineno-18-20" name="__codelineno-18-20" href="#__codelineno-18-20"></a><span class="n">d_calls</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">percs_calls</span><span class="w"> </span><span class="o">%&gt;%</span>
</span><span id="__span-18-21"><a id="__codelineno-18-21" name="__codelineno-18-21" href="#__codelineno-18-21"></a><span class="w">  </span><span class="nf">filter</span><span class="p">(</span><span class="nf">str_sub</span><span class="p">(</span><span class="n">api</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;B&quot;</span><span class="p">)</span>
</span><span id="__span-18-22"><a id="__codelineno-18-22" name="__codelineno-18-22" href="#__codelineno-18-22"></a>
</span><span id="__span-18-23"><a id="__codelineno-18-23" name="__codelineno-18-23" href="#__codelineno-18-23"></a><span class="n">dp_calls</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">percs_calls</span><span class="w"> </span><span class="o">%&gt;%</span>
</span><span id="__span-18-24"><a id="__codelineno-18-24" name="__codelineno-18-24" href="#__codelineno-18-24"></a><span class="w">  </span><span class="nf">filter</span><span class="p">(</span><span class="nf">str_sub</span><span class="p">(</span><span class="n">api</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;D&quot;</span><span class="p">)</span>
</span><span id="__span-18-25"><a id="__codelineno-18-25" name="__codelineno-18-25" href="#__codelineno-18-25"></a>
</span><span id="__span-18-26"><a id="__codelineno-18-26" name="__codelineno-18-26" href="#__codelineno-18-26"></a><span class="n">dl_percs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NULL</span>
</span><span id="__span-18-27"><a id="__codelineno-18-27" name="__codelineno-18-27" href="#__codelineno-18-27"></a>
</span><span id="__span-18-28"><a id="__codelineno-18-28" name="__codelineno-18-28" href="#__codelineno-18-28"></a><span class="nf">if</span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">s_calls</span><span class="o">$</span><span class="n">id</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0</span><span class="p">)){</span>
</span><span id="__span-18-29"><a id="__codelineno-18-29" name="__codelineno-18-29" href="#__codelineno-18-29"></a><span class="w">  </span><span class="n">s_percs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">get_acs</span><span class="p">(</span><span class="n">geography</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;tract&quot;</span><span class="p">,</span>
</span><span id="__span-18-30"><a id="__codelineno-18-30" name="__codelineno-18-30" href="#__codelineno-18-30"></a><span class="w">                     </span><span class="n">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ipd_states</span><span class="p">,</span>
</span><span id="__span-18-31"><a id="__codelineno-18-31" name="__codelineno-18-31" href="#__codelineno-18-31"></a><span class="w">                     </span><span class="n">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;wide&quot;</span><span class="p">,</span>
</span><span id="__span-18-32"><a id="__codelineno-18-32" name="__codelineno-18-32" href="#__codelineno-18-32"></a><span class="w">                     </span><span class="n">year</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ipd_year</span><span class="p">,</span>
</span><span id="__span-18-33"><a id="__codelineno-18-33" name="__codelineno-18-33" href="#__codelineno-18-33"></a><span class="w">                     </span><span class="n">variables</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s_calls</span><span class="o">$</span><span class="n">api</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
</span><span id="__span-18-34"><a id="__codelineno-18-34" name="__codelineno-18-34" href="#__codelineno-18-34"></a><span class="w">    </span><span class="nf">select</span><span class="p">(</span><span class="o">-</span><span class="n">NAME</span><span class="p">)</span>
</span><span id="__span-18-35"><a id="__codelineno-18-35" name="__codelineno-18-35" href="#__codelineno-18-35"></a><span class="w">  </span><span class="n">dl_percs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">bind_cols</span><span class="p">(</span><span class="n">dl_percs</span><span class="p">,</span><span class="w"> </span><span class="n">s_percs</span><span class="p">)</span>
</span><span id="__span-18-36"><a id="__codelineno-18-36" name="__codelineno-18-36" href="#__codelineno-18-36"></a><span class="p">}</span>
</span><span id="__span-18-37"><a id="__codelineno-18-37" name="__codelineno-18-37" href="#__codelineno-18-37"></a>
</span><span id="__span-18-38"><a id="__codelineno-18-38" name="__codelineno-18-38" href="#__codelineno-18-38"></a><span class="nf">if</span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">d_calls</span><span class="o">$</span><span class="n">id</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0</span><span class="p">)){</span>
</span><span id="__span-18-39"><a id="__codelineno-18-39" name="__codelineno-18-39" href="#__codelineno-18-39"></a><span class="w">  </span><span class="n">d_percs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">get_acs</span><span class="p">(</span><span class="n">geography</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;tract&quot;</span><span class="p">,</span>
</span><span id="__span-18-40"><a id="__codelineno-18-40" name="__codelineno-18-40" href="#__codelineno-18-40"></a><span class="w">                     </span><span class="n">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ipd_states</span><span class="p">,</span>
</span><span id="__span-18-41"><a id="__codelineno-18-41" name="__codelineno-18-41" href="#__codelineno-18-41"></a><span class="w">                     </span><span class="n">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;wide&quot;</span><span class="p">,</span>
</span><span id="__span-18-42"><a id="__codelineno-18-42" name="__codelineno-18-42" href="#__codelineno-18-42"></a><span class="w">                     </span><span class="n">year</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ipd_year</span><span class="p">,</span>
</span><span id="__span-18-43"><a id="__codelineno-18-43" name="__codelineno-18-43" href="#__codelineno-18-43"></a><span class="w">                     </span><span class="n">variables</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">d_calls</span><span class="o">$</span><span class="n">api</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
</span><span id="__span-18-44"><a id="__codelineno-18-44" name="__codelineno-18-44" href="#__codelineno-18-44"></a><span class="w">    </span><span class="nf">select</span><span class="p">(</span><span class="o">-</span><span class="n">NAME</span><span class="p">)</span>
</span><span id="__span-18-45"><a id="__codelineno-18-45" name="__codelineno-18-45" href="#__codelineno-18-45"></a><span class="w">  </span><span class="n">dl_percs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">left_join</span><span class="p">(</span><span class="n">dl_percs</span><span class="p">,</span><span class="w"> </span><span class="n">d_percs</span><span class="p">)</span>
</span><span id="__span-18-46"><a id="__codelineno-18-46" name="__codelineno-18-46" href="#__codelineno-18-46"></a><span class="p">}</span>
</span><span id="__span-18-47"><a id="__codelineno-18-47" name="__codelineno-18-47" href="#__codelineno-18-47"></a>
</span><span id="__span-18-48"><a id="__codelineno-18-48" name="__codelineno-18-48" href="#__codelineno-18-48"></a><span class="nf">if</span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">dp_calls</span><span class="o">$</span><span class="n">id</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0</span><span class="p">)){</span>
</span><span id="__span-18-49"><a id="__codelineno-18-49" name="__codelineno-18-49" href="#__codelineno-18-49"></a><span class="w">  </span><span class="n">dp_percs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">get_acs</span><span class="p">(</span><span class="n">geography</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;tract&quot;</span><span class="p">,</span>
</span><span id="__span-18-50"><a id="__codelineno-18-50" name="__codelineno-18-50" href="#__codelineno-18-50"></a><span class="w">                      </span><span class="n">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ipd_states</span><span class="p">,</span>
</span><span id="__span-18-51"><a id="__codelineno-18-51" name="__codelineno-18-51" href="#__codelineno-18-51"></a><span class="w">                      </span><span class="n">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;wide&quot;</span><span class="p">,</span>
</span><span id="__span-18-52"><a id="__codelineno-18-52" name="__codelineno-18-52" href="#__codelineno-18-52"></a><span class="w">                      </span><span class="n">year</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ipd_year</span><span class="p">,</span>
</span><span id="__span-18-53"><a id="__codelineno-18-53" name="__codelineno-18-53" href="#__codelineno-18-53"></a><span class="w">                      </span><span class="n">variables</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dp_calls</span><span class="o">$</span><span class="n">api</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
</span><span id="__span-18-54"><a id="__codelineno-18-54" name="__codelineno-18-54" href="#__codelineno-18-54"></a><span class="w">    </span><span class="nf">select</span><span class="p">(</span><span class="o">-</span><span class="n">NAME</span><span class="p">)</span>
</span><span id="__span-18-55"><a id="__codelineno-18-55" name="__codelineno-18-55" href="#__codelineno-18-55"></a><span class="w">  </span><span class="n">dl_percs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">left_join</span><span class="p">(</span><span class="n">dl_percs</span><span class="p">,</span><span class="w"> </span><span class="n">dp_percs</span><span class="p">)</span>
</span><span id="__span-18-56"><a id="__codelineno-18-56" name="__codelineno-18-56" href="#__codelineno-18-56"></a><span class="p">}</span>
</span><span id="__span-18-57"><a id="__codelineno-18-57" name="__codelineno-18-57" href="#__codelineno-18-57"></a>
</span><span id="__span-18-58"><a id="__codelineno-18-58" name="__codelineno-18-58" href="#__codelineno-18-58"></a><span class="n">dl_percs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dl_percs</span><span class="w"> </span><span class="o">%&gt;%</span>
</span><span id="__span-18-59"><a id="__codelineno-18-59" name="__codelineno-18-59" href="#__codelineno-18-59"></a><span class="w">  </span><span class="nf">rename</span><span class="p">(</span><span class="n">GEOID20</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GEOID</span><span class="p">)</span>
</span><span id="__span-18-60"><a id="__codelineno-18-60" name="__codelineno-18-60" href="#__codelineno-18-60"></a>
</span><span id="__span-18-61"><a id="__codelineno-18-61" name="__codelineno-18-61" href="#__codelineno-18-61"></a><span class="c1"># For DP downloads, make sure percs_calls and dl_percs match</span>
</span><span id="__span-18-62"><a id="__codelineno-18-62" name="__codelineno-18-62" href="#__codelineno-18-62"></a>
</span><span id="__span-18-63"><a id="__codelineno-18-63" name="__codelineno-18-63" href="#__codelineno-18-63"></a><span class="n">percs_calls</span><span class="o">$</span><span class="n">api</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">str_replace</span><span class="p">(</span><span class="n">percs_calls</span><span class="o">$</span><span class="n">api</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;PE&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span>
</span><span id="__span-18-64"><a id="__codelineno-18-64" name="__codelineno-18-64" href="#__codelineno-18-64"></a><span class="nf">names</span><span class="p">(</span><span class="n">dl_percs</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">str_replace</span><span class="p">(</span><span class="nf">names</span><span class="p">(</span><span class="n">dl_percs</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;PE&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;E&quot;</span><span class="p">)</span>
</span><span id="__span-18-65"><a id="__codelineno-18-65" name="__codelineno-18-65" href="#__codelineno-18-65"></a><span class="nf">names</span><span class="p">(</span><span class="n">dl_percs</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">str_replace</span><span class="p">(</span><span class="nf">names</span><span class="p">(</span><span class="n">dl_percs</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;PM&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;M&quot;</span><span class="p">)</span>
</span><span id="__span-18-66"><a id="__codelineno-18-66" name="__codelineno-18-66" href="#__codelineno-18-66"></a>
</span><span id="__span-18-67"><a id="__codelineno-18-67" name="__codelineno-18-67" href="#__codelineno-18-67"></a><span class="nf">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">percs_calls</span><span class="o">$</span><span class="n">id</span><span class="p">)){</span>
</span><span id="__span-18-68"><a id="__codelineno-18-68" name="__codelineno-18-68" href="#__codelineno-18-68"></a><span class="w">  </span><span class="nf">names</span><span class="p">(</span><span class="n">dl_percs</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">str_replace</span><span class="p">(</span><span class="nf">names</span><span class="p">(</span><span class="n">dl_percs</span><span class="p">),</span>
</span><span id="__span-18-69"><a id="__codelineno-18-69" name="__codelineno-18-69" href="#__codelineno-18-69"></a><span class="w">                                 </span><span class="n">percs_calls</span><span class="o">$</span><span class="n">api</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="__span-18-70"><a id="__codelineno-18-70" name="__codelineno-18-70" href="#__codelineno-18-70"></a><span class="w">                                 </span><span class="n">percs_calls</span><span class="o">$</span><span class="n">id</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="__span-18-71"><a id="__codelineno-18-71" name="__codelineno-18-71" href="#__codelineno-18-71"></a><span class="p">}</span>
</span></code></pre></div>
<h2 id="five_d">5d. Format downloads</h2>
<p>Subset <code>dl_counts</code> and <code>dl_percs</code> for DVRPC's nine-county region. Percentages should range from 0 to 100.
<br></p>
<div class="language-r highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="n">dl_counts</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dl_counts</span><span class="w"> </span><span class="o">%&gt;%</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="w">  </span><span class="nf">filter</span><span class="p">(</span><span class="nf">str_sub</span><span class="p">(</span><span class="n">GEOID20</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">ipd_counties</span><span class="p">)</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="n">dl_percs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dl_percs</span><span class="w"> </span><span class="o">%&gt;%</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="w">  </span><span class="nf">filter</span><span class="p">(</span><span class="nf">str_sub</span><span class="p">(</span><span class="n">GEOID20</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">ipd_counties</span><span class="p">)</span>
</span></code></pre></div>
<h3 id="five_d_i">5d.i. <em>Exception</em></h3>
<p>Note that variable <code>B02001_002 ("Estimate; Total: - White alone")</code> was downloaded as the count for racial minority. Compute <code>B02001_001 (Universe)</code> - <code>B02001_002 ("Estimate; Total: - White alone")</code> and substitute for <code>RM_CE</code>.
<br></p>
<div class="language-r highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="n">dl_counts</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dl_counts</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">mutate</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RM_UE</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">RM_CE</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="w">  </span><span class="nf">select</span><span class="p">(</span><span class="o">-</span><span class="n">RM_CE</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="w">  </span><span class="nf">rename</span><span class="p">(</span><span class="n">RM_CE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">)</span>
</span></code></pre></div>
<h3 id="five_d_ii">5d.ii. <em>Exception</em></h3>
<p>Half-standard deviations serve as the classification bins for IPD scores, and including zero-population tracts affects computed standard deviation values. Start by removing the 11 census tracts with zero population.
<br></p>
<div class="language-r highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="n">slicer</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;34005981802&quot;</span><span class="p">,</span><span class="s">&quot;34005982200&quot;</span><span class="p">,</span><span class="s">&quot;34021980000&quot;</span><span class="p">,</span><span class="s">&quot;42017980000&quot;</span><span class="p">,</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="w">            </span><span class="s">&quot;42045980300&quot;</span><span class="p">,</span><span class="s">&quot;42045980000&quot;</span><span class="p">,</span><span class="s">&quot;42045980200&quot;</span><span class="p">,</span><span class="s">&quot;42091980100&quot;</span><span class="p">,</span>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="w">            </span><span class="s">&quot;42091980000&quot;</span><span class="p">,</span><span class="s">&quot;42091980200&quot;</span><span class="p">,</span><span class="s">&quot;42091980300&quot;</span><span class="p">,</span><span class="s">&quot;42101036901&quot;</span><span class="p">,</span>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="w">            </span><span class="s">&quot;42101980001&quot;</span><span class="p">,</span><span class="s">&quot;42101980002&quot;</span><span class="p">,</span><span class="s">&quot;42101980003&quot;</span><span class="p">,</span><span class="s">&quot;42101980300&quot;</span><span class="p">,</span>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="w">            </span><span class="s">&quot;42101980701&quot;</span><span class="p">,</span><span class="s">&quot;42101980702&quot;</span><span class="p">,</span><span class="s">&quot;42101980800&quot;</span><span class="p">,</span><span class="s">&quot;42101980100&quot;</span><span class="p">,</span>
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a><span class="w">            </span><span class="s">&quot;42101980200&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;42101980400&quot;</span><span class="p">,</span><span class="s">&quot;42101980500&quot;</span><span class="p">,</span><span class="s">&quot;42101980600&quot;</span><span class="p">,</span>
</span><span id="__span-21-7"><a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a><span class="w">            </span><span class="s">&quot;42101980901&quot;</span><span class="p">,</span><span class="s">&quot;42101980902&quot;</span><span class="p">,</span><span class="s">&quot;42101980903&quot;</span><span class="p">,</span><span class="s">&quot;42101980904&quot;</span><span class="p">,</span>
</span><span id="__span-21-8"><a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a><span class="w">            </span><span class="s">&quot;42101980905&quot;</span><span class="p">,</span><span class="s">&quot;42101980906&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;42101989100&quot;</span><span class="p">,</span><span class="s">&quot;42101989200&quot;</span><span class="p">,</span>
</span><span id="__span-21-9"><a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a><span class="w">            </span><span class="s">&quot;42101989300&quot;</span><span class="p">)</span>
</span><span id="__span-21-10"><a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a><span class="n">dl_counts</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dl_counts</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">filter</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">GEOID20</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">slicer</span><span class="p">))</span>
</span><span id="__span-21-11"><a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a><span class="n">dl_percs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dl_percs</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">filter</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">GEOID20</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">slicer</span><span class="p">))</span>
</span></code></pre></div>
<p>Here are the first few lines of <code>dl_counts</code> and <code>dl_percs</code>. Notice the naming convention:</p>
<ul>
<li><code>UE</code> = universe estimate</li>
<li><code>UM</code> = universe MOE</li>
<li><code>CE</code> = count estimate</li>
<li><code>CM</code> = count MOE</li>
<li><code>PE</code> = percentage estimate</li>
<li><code>PM</code> = percentage MOE</li>
</ul>
<p>We use these strings to select columns, so consistency is key.
<br></p>
<h1 id="acs_estimates_calculations">6. ACS estimates calculations</h1>
<p>For all nine indicators, this section computes:</p>
<ul>
<li>Percentages and percentage MOEs</li>
<li>Percentile</li>
<li>IPD score and classification</li>
<li>Composite IPD score</li>
</ul>
<p>Split <code>dl_counts</code> into a list named <code>comp</code> for processing and arrange column names in alphabetical order. The name of the list, <code>comp</code>, is a nod to the "component parts" of <code>dl_counts</code>. The structure of <code>comp</code> is similar to a four-tab Excel spreadsheet: for example, <code>comp</code> is the name of the <code>.xlsx</code> file, <code>uni_est</code> is a tab for universe estimates, and <code>uni_est</code> has nine columns and 1,368 rows, where the column is the IPD indicator and the row is the census tract observation.</p>
<p>The order of columns is important because processing is based on vector position. We want to make sure that the first column of every tab corresponds to the Disabled indicator, the second to Ethnic Minority, et cetera.
<br></p>
<div class="language-r highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="n">comp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">()</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="n">comp</span><span class="o">$</span><span class="n">uni_est</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dl_counts</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">select</span><span class="p">(</span><span class="nf">ends_with</span><span class="p">(</span><span class="s">&quot;UE&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">select</span><span class="p">(</span><span class="nf">sort</span><span class="p">(</span><span class="n">tidyselect</span><span class="o">::</span><span class="nf">peek_vars</span><span class="p">()))</span>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="n">comp</span><span class="o">$</span><span class="n">uni_moe</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dl_counts</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">select</span><span class="p">(</span><span class="nf">ends_with</span><span class="p">(</span><span class="s">&quot;UM&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">select</span><span class="p">(</span><span class="nf">sort</span><span class="p">(</span><span class="n">tidyselect</span><span class="o">::</span><span class="nf">peek_vars</span><span class="p">()))</span>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="n">comp</span><span class="o">$</span><span class="n">count_est</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dl_counts</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">select</span><span class="p">(</span><span class="nf">ends_with</span><span class="p">(</span><span class="s">&quot;CE&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">select</span><span class="p">(</span><span class="nf">sort</span><span class="p">(</span><span class="n">tidyselect</span><span class="o">::</span><span class="nf">peek_vars</span><span class="p">()))</span>
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="n">comp</span><span class="o">$</span><span class="n">count_moe</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dl_counts</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">select</span><span class="p">(</span><span class="nf">ends_with</span><span class="p">(</span><span class="s">&quot;CM&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">select</span><span class="p">(</span><span class="nf">sort</span><span class="p">(</span><span class="n">tidyselect</span><span class="o">::</span><span class="nf">peek_vars</span><span class="p">()))</span>
</span></code></pre></div>
<h2 id="six_a">6a. Percentages and percentage MOEs</h2>
<h3 id="six_a_i">6a.i. Calculation</h3>
<p>MOEs of the percentage values are obtained using the <code>tidycensus</code> function <code>moe_prop</code>. This chunk mentions <code>r</code> and <code>c</code> several times: continuing the spreadsheet analogy, think of <code>r</code> as the row number and <code>c</code> as the column number for a given spreadsheet tab.
<br></p>
<div class="language-r highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="n">pct_matrix</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NULL</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="n">pct_moe_matrix</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NULL</span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="nf">for </span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">comp</span><span class="o">$</span><span class="n">uni_est</span><span class="p">)){</span>
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="w">  </span><span class="n">pct</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">unlist</span><span class="p">(</span><span class="n">comp</span><span class="o">$</span><span class="n">count_est</span><span class="p">[,</span><span class="n">c</span><span class="p">]</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">comp</span><span class="o">$</span><span class="n">uni_est</span><span class="p">[,</span><span class="n">c</span><span class="p">])</span>
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="w">  </span><span class="n">pct_matrix</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">cbind</span><span class="p">(</span><span class="n">pct_matrix</span><span class="p">,</span><span class="w"> </span><span class="n">pct</span><span class="p">)</span>
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="w">  </span><span class="n">moe</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NULL</span>
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="w">  </span><span class="nf">for </span><span class="p">(</span><span class="n">r</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">comp</span><span class="o">$</span><span class="n">uni_est</span><span class="o">$</span><span class="n">LI_UE</span><span class="p">)){</span>
</span><span id="__span-23-8"><a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a><span class="w">    </span><span class="n">moe_indiv</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="nf">moe_prop</span><span class="p">(</span><span class="n">comp</span><span class="o">$</span><span class="n">count_est</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">],</span>
</span><span id="__span-23-9"><a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a><span class="w">                                     </span><span class="n">comp</span><span class="o">$</span><span class="n">uni_est</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">],</span>
</span><span id="__span-23-10"><a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a><span class="w">                                     </span><span class="n">comp</span><span class="o">$</span><span class="n">count_moe</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">],</span>
</span><span id="__span-23-11"><a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a><span class="w">                                     </span><span class="n">comp</span><span class="o">$</span><span class="n">uni_moe</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]))</span>
</span><span id="__span-23-12"><a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a><span class="w">    </span><span class="n">moe</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">append</span><span class="p">(</span><span class="n">moe</span><span class="p">,</span><span class="w"> </span><span class="n">moe_indiv</span><span class="p">)</span>
</span><span id="__span-23-13"><a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-23-14"><a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a><span class="w">  </span><span class="n">pct_moe_matrix</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">cbind</span><span class="p">(</span><span class="n">pct_moe_matrix</span><span class="p">,</span><span class="w"> </span><span class="n">moe</span><span class="p">)</span>
</span><span id="__span-23-15"><a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="six_a_ii">6a.ii. Result</h3>
<p><code>pct</code> and <code>pct_moe</code> stores the percentages and associated MOEs for the nine indicator variables. Results are rounded to the tenths place and range from 0 to 100.
<br></p>
<div class="language-r highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="n">pct</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as_tibble</span><span class="p">(</span><span class="n">pct_matrix</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">mutate_all</span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="n">.</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">100</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">mutate_all</span><span class="p">(</span><span class="n">round_1</span><span class="p">)</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="nf">names</span><span class="p">(</span><span class="n">pct</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">str_replace</span><span class="p">(</span><span class="nf">names</span><span class="p">(</span><span class="n">comp</span><span class="o">$</span><span class="n">uni_est</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;_UE&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_PctEst&quot;</span><span class="p">)</span>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="n">pct_moe</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as_tibble</span><span class="p">(</span><span class="n">pct_moe_matrix</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">mutate_all</span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="n">.</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">100</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">mutate_all</span><span class="p">(</span><span class="n">round_1</span><span class="p">)</span>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a><span class="nf">names</span><span class="p">(</span><span class="n">pct_moe</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">str_replace</span><span class="p">(</span><span class="nf">names</span><span class="p">(</span><span class="n">comp</span><span class="o">$</span><span class="n">uni_est</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;_UE&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_PctMOE&quot;</span><span class="p">)</span>
</span></code></pre></div>
<h3 id="six_a_iii">6a.iii. <em>Exception</em></h3>
<p>If the percentage MOE equals 0, then overwrite it to equal 0.1. This should be a rare occurence with survey data at the census tract level.
<br></p>
<div class="language-r highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="n">pct_moe</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pct_moe</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">replace</span><span class="p">(</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">.</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">0.1</span><span class="p">)</span>
</span></code></pre></div>
<h3 id="six_a_iv">6a.iv. <em>Exception</em></h3>
<p>Substitute percentages and associated MOEs when available. This applies to the older adults, female, limited English proficiency, and disabled variables.
<br></p>
<div class="language-r highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="n">pct</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pct</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">mutate</span><span class="p">(</span><span class="n">D_PctEst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dl_percs</span><span class="o">$</span><span class="n">D_PE</span><span class="p">,</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="w">                      </span><span class="n">OA_PctEst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dl_percs</span><span class="o">$</span><span class="n">OA_PE</span><span class="p">,</span>
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="w">                      </span><span class="n">LEP_PctEst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dl_percs</span><span class="o">$</span><span class="n">LEP_PE</span><span class="p">,</span>
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a><span class="w">                      </span><span class="n">F_PctEst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dl_percs</span><span class="o">$</span><span class="n">F_PE</span><span class="p">)</span>
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a><span class="n">pct_moe</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pct_moe</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">mutate</span><span class="p">(</span><span class="n">D_PctMOE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dl_percs</span><span class="o">$</span><span class="n">D_PM</span><span class="p">,</span>
</span><span id="__span-26-6"><a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a><span class="w">                              </span><span class="n">OA_PctMOE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dl_percs</span><span class="o">$</span><span class="n">OA_PM</span><span class="p">,</span>
</span><span id="__span-26-7"><a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a><span class="w">                              </span><span class="n">LEP_PctMOE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dl_percs</span><span class="o">$</span><span class="n">LEP_PM</span><span class="p">,</span>
</span><span id="__span-26-8"><a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a><span class="w">                              </span><span class="n">F_PctMOE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dl_percs</span><span class="o">$</span><span class="n">F_PM</span><span class="p">)</span>
</span></code></pre></div>
<h2 id="six_b">6b. Percentile</h2>
<h3 id="six__b_i">6b.i. Calculation</h3>
<p>Add percentiles (an additional "spreadsheet tab") to <code>comp</code>, making sure to first sort column names alphabetically. Compute the empirical cumulative distribution function for each of the nine indicator variables. The ECDF can range from 0 to 1, where 1 indicates the largest observed percentage.
<br></p>
<div class="language-r highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="n">comp</span><span class="o">$</span><span class="n">pct_est</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pct</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">select</span><span class="p">(</span><span class="nf">sort</span><span class="p">(</span><span class="n">tidyselect</span><span class="o">::</span><span class="nf">peek_vars</span><span class="p">()))</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="n">percentile_matrix</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NULL</span>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="nf">for </span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">comp</span><span class="o">$</span><span class="n">uni_est</span><span class="p">)){</span>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="w">  </span><span class="n">p</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">unlist</span><span class="p">(</span><span class="n">comp</span><span class="o">$</span><span class="n">pct_est</span><span class="p">[,</span><span class="n">c</span><span class="p">])</span>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a><span class="w">  </span><span class="n">rank</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">ecdf</span><span class="p">(</span><span class="n">p</span><span class="p">)(</span><span class="n">p</span><span class="p">)</span>
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a><span class="w">  </span><span class="n">percentile_matrix</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">cbind</span><span class="p">(</span><span class="n">percentile_matrix</span><span class="p">,</span><span class="w"> </span><span class="n">rank</span><span class="p">)</span>
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="six_b_ii">6b.ii. Result</h3>
<p><code>percentile</code> stores the percentile for the nine indicator variables. Results are rounded to the hundredths place.
<br></p>
<div class="language-r highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="n">percentile</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as_tibble</span><span class="p">(</span><span class="n">percentile_matrix</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">mutate_all</span><span class="p">(</span><span class="n">round_2</span><span class="p">)</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="nf">names</span><span class="p">(</span><span class="n">percentile</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">str_replace</span><span class="p">(</span><span class="nf">names</span><span class="p">(</span><span class="n">comp</span><span class="o">$</span><span class="n">uni_est</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;_UE&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_Pctile&quot;</span><span class="p">)</span>
</span></code></pre></div>
<h2 id="six_c">6c. IPD score and classification</h2>
<p>Each observation is assigned an IPD score for each indicator. The IPD score for an individual indicator can range from 0 to 4, which corresponds to the following classification and bin breaks:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">IPD Score</th>
<th style="text-align: center;">IPD Classification</th>
<th style="text-align: right;">Standard Deviations</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">0</td>
<td style="text-align: center;">Well Below Average</td>
<td style="text-align: right;">x <span class="arithmatex">\(&lt; -1.5 \cdot stdev\)</span></td>
</tr>
<tr>
<td style="text-align: left;">1</td>
<td style="text-align: center;">Below Average</td>
<td style="text-align: right;"><span class="arithmatex">\(-1.5 \cdot stdev \leq\)</span> x <span class="arithmatex">\(&lt;-0.5 \cdot stdev\)</span></td>
</tr>
<tr>
<td style="text-align: left;">2</td>
<td style="text-align: center;">Average</td>
<td style="text-align: right;"><span class="arithmatex">\(-0.5 \cdot stdev \leq\)</span> x <span class="arithmatex">\(&lt;0.5 \cdot stdev\)</span></td>
</tr>
<tr>
<td style="text-align: left;">3</td>
<td style="text-align: center;">Above Average</td>
<td style="text-align: right;"><span class="arithmatex">\(0.5 \cdot stdev \leq\)</span> x <span class="arithmatex">\(&lt;1.5 \cdot stdev\)</span></td>
</tr>
<tr>
<td style="text-align: left;">4</td>
<td style="text-align: center;">Well Above Average</td>
<td style="text-align: right;">x <span class="arithmatex">\(\geq 1.5 \cdot stdev\)</span></td>
</tr>
</tbody>
</table>
<p><br></p>
<h3 id="six_c_i">6c.i. Calculation</h3>
<p>The function <code>st_dev_breaks</code> is called to compute the bin breaks for each indicator. These breaks determine the IPD score stored in <code>score</code>. Note that we divide <em>rounded</em> <code>PctEst</code> columns by <em>unrounded</em> half-standard deviation breaks to compute the <code>score</code>. <code>class</code> is a textual explanation of the IPD score.
<br></p>
<div class="language-r highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="n">score_matrix</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NULL</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="n">class_matrix</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NULL</span>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="nf">for </span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">comp</span><span class="o">$</span><span class="n">uni_est</span><span class="p">)){</span>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="w">  </span><span class="n">p</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">unlist</span><span class="p">(</span><span class="n">comp</span><span class="o">$</span><span class="n">pct_est</span><span class="p">[,</span><span class="n">c</span><span class="p">])</span>
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="w">  </span><span class="n">breaks</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">st_dev_breaks</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span>
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a><span class="w">  </span><span class="n">score</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">case_when</span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">breaks</span><span class="p">[</span><span class="m">2</span><span class="p">]</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="m">0</span><span class="p">,</span>
</span><span id="__span-29-7"><a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a><span class="w">                     </span><span class="n">p</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">breaks</span><span class="p">[</span><span class="m">2</span><span class="p">]</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">breaks</span><span class="p">[</span><span class="m">3</span><span class="p">]</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="m">1</span><span class="p">,</span>
</span><span id="__span-29-8"><a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a><span class="w">                     </span><span class="n">p</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">breaks</span><span class="p">[</span><span class="m">3</span><span class="p">]</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">breaks</span><span class="p">[</span><span class="m">4</span><span class="p">]</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="m">2</span><span class="p">,</span>
</span><span id="__span-29-9"><a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a><span class="w">                     </span><span class="n">p</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">breaks</span><span class="p">[</span><span class="m">4</span><span class="p">]</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">breaks</span><span class="p">[</span><span class="m">5</span><span class="p">]</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="m">3</span><span class="p">,</span>
</span><span id="__span-29-10"><a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a><span class="w">                     </span><span class="n">p</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">breaks</span><span class="p">[</span><span class="m">5</span><span class="p">]</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="m">4</span><span class="p">)</span>
</span><span id="__span-29-11"><a id="__codelineno-29-11" name="__codelineno-29-11" href="#__codelineno-29-11"></a><span class="w">  </span><span class="n">class</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">case_when</span><span class="p">(</span><span class="n">score</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s">&quot;Well Below Average&quot;</span><span class="p">,</span>
</span><span id="__span-29-12"><a id="__codelineno-29-12" name="__codelineno-29-12" href="#__codelineno-29-12"></a><span class="w">                     </span><span class="n">score</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s">&quot;Below Average&quot;</span><span class="p">,</span>
</span><span id="__span-29-13"><a id="__codelineno-29-13" name="__codelineno-29-13" href="#__codelineno-29-13"></a><span class="w">                     </span><span class="n">score</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s">&quot;Average&quot;</span><span class="p">,</span>
</span><span id="__span-29-14"><a id="__codelineno-29-14" name="__codelineno-29-14" href="#__codelineno-29-14"></a><span class="w">                     </span><span class="n">score</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s">&quot;Above Average&quot;</span><span class="p">,</span>
</span><span id="__span-29-15"><a id="__codelineno-29-15" name="__codelineno-29-15" href="#__codelineno-29-15"></a><span class="w">                     </span><span class="n">score</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s">&quot;Well Above Average&quot;</span><span class="p">)</span>
</span><span id="__span-29-16"><a id="__codelineno-29-16" name="__codelineno-29-16" href="#__codelineno-29-16"></a><span class="w">  </span><span class="n">score_matrix</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">cbind</span><span class="p">(</span><span class="n">score_matrix</span><span class="p">,</span><span class="w"> </span><span class="n">score</span><span class="p">)</span>
</span><span id="__span-29-17"><a id="__codelineno-29-17" name="__codelineno-29-17" href="#__codelineno-29-17"></a><span class="w">  </span><span class="n">class_matrix</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">cbind</span><span class="p">(</span><span class="n">class_matrix</span><span class="p">,</span><span class="w"> </span><span class="n">class</span><span class="p">)</span>
</span><span id="__span-29-18"><a id="__codelineno-29-18" name="__codelineno-29-18" href="#__codelineno-29-18"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="six_c_ii">6c.ii. Result</h3>
<p><code>score</code> and <code>class</code> store the IPD scores and associated descriptions for the nine indicator variables.
<br></p>
<div class="language-r highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="n">score</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as_tibble</span><span class="p">(</span><span class="n">score_matrix</span><span class="p">)</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="nf">names</span><span class="p">(</span><span class="n">score</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">str_replace</span><span class="p">(</span><span class="nf">names</span><span class="p">(</span><span class="n">comp</span><span class="o">$</span><span class="n">uni_est</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;_UE&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_Score&quot;</span><span class="p">)</span>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="n">class</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as_tibble</span><span class="p">(</span><span class="n">class_matrix</span><span class="p">)</span>
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a><span class="nf">names</span><span class="p">(</span><span class="n">class</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">str_replace</span><span class="p">(</span><span class="nf">names</span><span class="p">(</span><span class="n">comp</span><span class="o">$</span><span class="n">uni_est</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;_UE&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_Class&quot;</span><span class="p">)</span>
</span></code></pre></div>
<h2 id="six_d">6d. Composite IPD score</h2>
<h3 id="six_d_i">6d.i. Calculation</h3>
<p>Sum the IPD scores for the nine indicator variables to determine the composite IPD score.
<br></p>
<div class="language-r highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="n">score</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">score</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">mutate</span><span class="p">(</span><span class="n">IPD_Score</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rowSums</span><span class="p">(</span><span class="n">.</span><span class="p">))</span>
</span></code></pre></div>
<h1 id="acs_estimates_cleaning">7. ACS estimates cleaning</h1>
<p>There is a specific output format for <code>ipd.csv</code>, including column names, column order, flags for missing data, and census tracts with insufficient data. This section ensures conformity with the output formatting.</p>
<p>Merge the percentage estimates, percentage MOEs, percentile, score, and class data frames into a single data frame called <code>ipd</code>.
<br></p>
<div class="language-r highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="n">ipd</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">bind_cols</span><span class="p">(</span><span class="n">dl_counts</span><span class="p">,</span><span class="w"> </span><span class="n">pct</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="w">  </span><span class="nf">bind_cols</span><span class="p">(</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">pct_moe</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a><span class="w">  </span><span class="nf">bind_cols</span><span class="p">(</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">percentile</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a><span class="w">  </span><span class="nf">bind_cols</span><span class="p">(</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">score</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
</span><span id="__span-32-5"><a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a><span class="w">  </span><span class="nf">bind_cols</span><span class="p">(</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">class</span><span class="p">)</span>
</span></code></pre></div>
<p>Rename columns.
<br></p>
<div class="language-r highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="nf">names</span><span class="p">(</span><span class="n">ipd</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">str_replace</span><span class="p">(</span><span class="nf">names</span><span class="p">(</span><span class="n">ipd</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;_CE&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_CntEst&quot;</span><span class="p">)</span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="nf">names</span><span class="p">(</span><span class="n">ipd</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">str_replace</span><span class="p">(</span><span class="nf">names</span><span class="p">(</span><span class="n">ipd</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;_CM&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_CntMOE&quot;</span><span class="p">)</span>
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a><span class="n">ipd</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ipd</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">mutate</span><span class="p">(</span><span class="n">STATEFP20</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">str_sub</span><span class="p">(</span><span class="n">GEOID20</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">),</span>
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a><span class="w">                      </span><span class="n">COUNTYFP20</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">str_sub</span><span class="p">(</span><span class="n">GEOID20</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">),</span>
</span><span id="__span-33-5"><a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a><span class="w">                      </span><span class="n">NAME20</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">str_sub</span><span class="p">(</span><span class="n">GEOID20</span><span class="p">,</span><span class="w"> </span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">11</span><span class="p">),</span>
</span><span id="__span-33-6"><a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a><span class="w">                      </span><span class="n">U_TPopEst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">F_UE</span><span class="p">,</span>
</span><span id="__span-33-7"><a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a><span class="w">                      </span><span class="n">U_TPopMOE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">F_UM</span><span class="p">,</span>
</span><span id="__span-33-8"><a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a><span class="w">                      </span><span class="n">U_Pop6Est</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LEP_UE</span><span class="p">,</span>
</span><span id="__span-33-9"><a id="__codelineno-33-9" name="__codelineno-33-9" href="#__codelineno-33-9"></a><span class="w">                      </span><span class="n">U_Pop6MOE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LEP_UM</span><span class="p">,</span>
</span><span id="__span-33-10"><a id="__codelineno-33-10" name="__codelineno-33-10" href="#__codelineno-33-10"></a><span class="w">                      </span><span class="n">U_PPovEst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LI_UE</span><span class="p">,</span>
</span><span id="__span-33-11"><a id="__codelineno-33-11" name="__codelineno-33-11" href="#__codelineno-33-11"></a><span class="w">                      </span><span class="n">U_PPovMOE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LI_UM</span><span class="p">,</span>
</span><span id="__span-33-12"><a id="__codelineno-33-12" name="__codelineno-33-12" href="#__codelineno-33-12"></a><span class="w">                      </span><span class="n">U_PNICEst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">D_UE</span><span class="p">,</span>
</span><span id="__span-33-13"><a id="__codelineno-33-13" name="__codelineno-33-13" href="#__codelineno-33-13"></a><span class="w">                      </span><span class="n">U_PNICMOE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">D_UM</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
</span><span id="__span-33-14"><a id="__codelineno-33-14" name="__codelineno-33-14" href="#__codelineno-33-14"></a><span class="w">  </span><span class="nf">select</span><span class="p">(</span><span class="o">-</span><span class="nf">ends_with</span><span class="p">(</span><span class="s">&quot;UE&quot;</span><span class="p">),</span><span class="w"> </span><span class="o">-</span><span class="nf">ends_with</span><span class="p">(</span><span class="s">&quot;UM&quot;</span><span class="p">))</span>
</span></code></pre></div>
<p>Reorder columns, with <code>GEOID</code> and FIPS codes first, the following variables in alphabetical order, and the total IPD score and universes at the end.
<br></p>
<div class="language-r highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="n">ipd</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ipd</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">select</span><span class="p">(</span><span class="n">GEOID20</span><span class="p">,</span><span class="w"> </span><span class="n">STATEFP20</span><span class="p">,</span><span class="w"> </span><span class="n">COUNTYFP20</span><span class="p">,</span><span class="w"> </span><span class="n">NAME20</span><span class="p">,</span><span class="w"> </span><span class="nf">sort</span><span class="p">(</span><span class="n">tidyselect</span><span class="o">::</span><span class="nf">peek_vars</span><span class="p">()))</span><span class="w"> </span><span class="o">%&gt;%</span>
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="w">  </span><span class="nf">select</span><span class="p">(</span><span class="nf">move_last</span><span class="p">(</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;IPD_Score&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;U_TPopEst&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;U_TPopMOE&quot;</span><span class="p">,</span>
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="w">                        </span><span class="s">&quot;U_Pop6Est&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;U_Pop6MOE&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;U_PPovEst&quot;</span><span class="p">,</span>
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a><span class="w">                        </span><span class="s">&quot;U_PPovMOE&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;U_PNICEst&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;U_PNICMOE&quot;</span><span class="p">)))</span>
</span></code></pre></div>
<p>At the beginning of processing, we removed the slicer census tracts from processing because their populations were equal to zero. Tack these back on to the dataset.
<br></p>
<div class="language-r highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="n">slicer</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">enframe</span><span class="p">(</span><span class="n">slicer</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;GEOID20&quot;</span><span class="p">)</span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="n">ipd</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">plyr</span><span class="o">::</span><span class="nf">rbind.fill</span><span class="p">(</span><span class="n">ipd</span><span class="p">,</span><span class="w"> </span><span class="n">slicer</span><span class="p">)</span>
</span></code></pre></div>
<p>Replace <code>NA</code> values with <code>NoData</code> if character we'll wait to replace <code>NA</code> with <code>-99999</code> if numeric.
<br></p>
<div class="language-r highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="n">ipd</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ipd</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">mutate_if</span><span class="p">(</span><span class="n">is.character</span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="p">(</span><span class="nf">ifelse</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">.</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;NoData&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">.</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span>
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a><span class="w">  </span><span class="nf">mutate_if</span><span class="p">(</span><span class="n">is.numeric</span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="p">(</span><span class="nf">ifelse</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">.</span><span class="p">),</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">.</span><span class="p">)))</span>
</span></code></pre></div>
<h1 id="summary_tables">8. Summary Tables</h1>
<p>This section generates a handful of other deliverables, including:</p>
<p>a. Counts by indicator
b. Breaks by indicator
c. Summary by indicator
d. County means by indicator</p>
<p>Replace <code>-99999</code> with <code>0</code> for numeric columns to avoid distorting summary statistics.
<br></p>
<div class="language-r highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="n">ipd_summary</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ipd</span>
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a><span class="n">ipd_summary</span><span class="p">[</span><span class="n">ipd_summary</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="p">]</span>
</span></code></pre></div>
<h2 id="eight_a">8a. Counts by indicator</h2>
<p>The number of census tracts that fall in each bin. Count census tracts by indicator and bin. Reorder factor levels so that "Well Below Average" appears before "Below Average," and the like.
<br></p>
<div class="language-r highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="n">counts</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ipd_summary</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">select</span><span class="p">(</span><span class="nf">ends_with</span><span class="p">(</span><span class="s">&quot;Class&quot;</span><span class="p">))</span>
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a><span class="n">export_counts</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="n">plyr</span><span class="o">::</span><span class="nf">count</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
</span><span id="__span-38-3"><a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a><span class="nf">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">export_counts</span><span class="p">)){</span>
</span><span id="__span-38-4"><a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a><span class="w">  </span><span class="n">export_counts</span><span class="p">[[</span><span class="n">i</span><span class="p">]]</span><span class="o">$</span><span class="n">var</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">names</span><span class="p">(</span><span class="n">export_counts</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span>
</span><span id="__span-38-5"><a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a><span class="p">}</span>
</span><span id="__span-38-6"><a id="__codelineno-38-6" name="__codelineno-38-6" href="#__codelineno-38-6"></a><span class="n">export_counts</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">map_dfr</span><span class="p">(</span><span class="n">export_counts</span><span class="p">,</span><span class="w"> </span><span class="n">`[`</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;var&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;x&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;freq&quot;</span><span class="p">))</span>
</span><span id="__span-38-7"><a id="__codelineno-38-7" name="__codelineno-38-7" href="#__codelineno-38-7"></a><span class="n">counts</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ipd_summary</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">select</span><span class="p">(</span><span class="nf">ends_with</span><span class="p">(</span><span class="s">&quot;Class&quot;</span><span class="p">))</span>
</span><span id="__span-38-8"><a id="__codelineno-38-8" name="__codelineno-38-8" href="#__codelineno-38-8"></a><span class="n">export_counts</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="n">plyr</span><span class="o">::</span><span class="nf">count</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
</span><span id="__span-38-9"><a id="__codelineno-38-9" name="__codelineno-38-9" href="#__codelineno-38-9"></a><span class="nf">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">export_counts</span><span class="p">)){</span>
</span><span id="__span-38-10"><a id="__codelineno-38-10" name="__codelineno-38-10" href="#__codelineno-38-10"></a><span class="w">  </span><span class="n">export_counts</span><span class="p">[[</span><span class="n">i</span><span class="p">]]</span><span class="o">$</span><span class="n">var</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">names</span><span class="p">(</span><span class="n">export_counts</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span>
</span><span id="__span-38-11"><a id="__codelineno-38-11" name="__codelineno-38-11" href="#__codelineno-38-11"></a><span class="p">}</span>
</span><span id="__span-38-12"><a id="__codelineno-38-12" name="__codelineno-38-12" href="#__codelineno-38-12"></a><span class="n">export_counts</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">map_dfr</span><span class="p">(</span><span class="n">export_counts</span><span class="p">,</span><span class="w"> </span><span class="n">`[`</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;var&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;x&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;freq&quot;</span><span class="p">))</span>
</span><span id="__span-38-13"><a id="__codelineno-38-13" name="__codelineno-38-13" href="#__codelineno-38-13"></a><span class="nf">colnames</span><span class="p">(</span><span class="n">export_counts</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;Variable&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Classification&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Count&quot;</span><span class="p">)</span>
</span><span id="__span-38-14"><a id="__codelineno-38-14" name="__codelineno-38-14" href="#__codelineno-38-14"></a><span class="n">export_counts</span><span class="o">$</span><span class="n">Classification</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">factor</span><span class="p">(</span><span class="n">export_counts</span><span class="o">$</span><span class="n">Classification</span><span class="p">,</span>
</span><span id="__span-38-15"><a id="__codelineno-38-15" name="__codelineno-38-15" href="#__codelineno-38-15"></a><span class="w">                                       </span><span class="n">levels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;Well Below Average&quot;</span><span class="p">,</span>
</span><span id="__span-38-16"><a id="__codelineno-38-16" name="__codelineno-38-16" href="#__codelineno-38-16"></a><span class="w">                                                  </span><span class="s">&quot;Below Average&quot;</span><span class="p">,</span>
</span><span id="__span-38-17"><a id="__codelineno-38-17" name="__codelineno-38-17" href="#__codelineno-38-17"></a><span class="w">                                                  </span><span class="s">&quot;Average&quot;</span><span class="p">,</span>
</span><span id="__span-38-18"><a id="__codelineno-38-18" name="__codelineno-38-18" href="#__codelineno-38-18"></a><span class="w">                                                  </span><span class="s">&quot;Above Average&quot;</span><span class="p">,</span>
</span><span id="__span-38-19"><a id="__codelineno-38-19" name="__codelineno-38-19" href="#__codelineno-38-19"></a><span class="w">                                                  </span><span class="s">&quot;Well Above Average&quot;</span><span class="p">,</span>
</span><span id="__span-38-20"><a id="__codelineno-38-20" name="__codelineno-38-20" href="#__codelineno-38-20"></a><span class="w">                                                  </span><span class="s">&quot;NoData&quot;</span><span class="p">))</span>
</span><span id="__span-38-21"><a id="__codelineno-38-21" name="__codelineno-38-21" href="#__codelineno-38-21"></a><span class="n">export_counts</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">arrange</span><span class="p">(</span><span class="n">export_counts</span><span class="p">,</span><span class="w"> </span><span class="n">Variable</span><span class="p">,</span><span class="w"> </span><span class="n">Classification</span><span class="p">)</span>
</span><span id="__span-38-22"><a id="__codelineno-38-22" name="__codelineno-38-22" href="#__codelineno-38-22"></a><span class="n">export_counts</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">export_counts</span><span class="w"> </span><span class="o">%&gt;%</span>
</span><span id="__span-38-23"><a id="__codelineno-38-23" name="__codelineno-38-23" href="#__codelineno-38-23"></a><span class="w">  </span><span class="nf">spread</span><span class="p">(</span><span class="n">Classification</span><span class="p">,</span><span class="w"> </span><span class="n">Count</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
</span><span id="__span-38-24"><a id="__codelineno-38-24" name="__codelineno-38-24" href="#__codelineno-38-24"></a><span class="w">  </span><span class="nf">mutate_all</span><span class="p">(</span><span class="o">~</span><span class="p">(</span><span class="nf">replace_na</span><span class="p">(</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span>
</span><span id="__span-38-25"><a id="__codelineno-38-25" name="__codelineno-38-25" href="#__codelineno-38-25"></a><span class="w">  </span><span class="nf">mutate</span><span class="p">(</span><span class="n">TOTAL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rowSums</span><span class="p">(</span><span class="n">.</span><span class="p">[</span><span class="m">2</span><span class="o">:</span><span class="m">7</span><span class="p">],</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">))</span>
</span></code></pre></div>
<h2 id="eight_b">8b. Breaks by indicator</h2>
<p>The bin breaks for each indicator. Apply the <code>st_dev_breaks</code> function to all percentage values and export results.
<br></p>
<div class="language-r highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="n">breaks</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ipd_summary</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">select</span><span class="p">(</span><span class="nf">ends_with</span><span class="p">(</span><span class="s">&quot;PctEst&quot;</span><span class="p">))</span>
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a><span class="n">export_breaks</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="nf">mapply</span><span class="p">(</span><span class="n">st_dev_breaks</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">breaks</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">),</span><span class="w"> </span><span class="n">digits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">)</span>
</span><span id="__span-39-3"><a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a><span class="n">export_breaks</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as_tibble</span><span class="p">(</span><span class="n">export_breaks</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
</span><span id="__span-39-4"><a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a><span class="w">  </span><span class="nf">mutate</span><span class="p">(</span><span class="n">Class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;Min&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;2&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;3&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;4&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Max&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
</span><span id="__span-39-5"><a id="__codelineno-39-5" name="__codelineno-39-5" href="#__codelineno-39-5"></a><span class="w">  </span><span class="nf">select</span><span class="p">(</span><span class="n">Class</span><span class="p">,</span><span class="w"> </span><span class="n">tidyselect</span><span class="o">::</span><span class="nf">peek_vars</span><span class="p">())</span>
</span></code></pre></div>
<h2 id="eight_c">8c. Summary by indicator</h2>
<p>Summary statistics of each indicator. Round results to two decimal places.
<br></p>
<div class="language-r highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="n">pcts</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ipd_summary</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">select</span><span class="p">(</span><span class="nf">ends_with</span><span class="p">(</span><span class="s">&quot;PctEst&quot;</span><span class="p">))</span>
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="n">summary_data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="n">pcts</span><span class="p">,</span><span class="w"> </span><span class="n">MARGIN</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="p">)</span>
</span><span id="__span-40-3"><a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a><span class="n">export_summary</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as_tibble</span><span class="p">(</span><span class="n">summary_data</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
</span><span id="__span-40-4"><a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a><span class="w">  </span><span class="nf">mutate_all</span><span class="p">(</span><span class="n">round_2</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
</span><span id="__span-40-5"><a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a><span class="w">  </span><span class="nf">mutate</span><span class="p">(</span><span class="n">Statistic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;Minimum&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Median&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Mean&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SD&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Half-SD&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Maximum&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
</span><span id="__span-40-6"><a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a><span class="w">  </span><span class="nf">select</span><span class="p">(</span><span class="n">Statistic</span><span class="p">,</span><span class="w"> </span><span class="n">tidyselect</span><span class="o">::</span><span class="nf">peek_vars</span><span class="p">())</span>
</span></code></pre></div>
<h2 id="eight_d">8d. County means by indicator</h2>
<p>Population-weighted means by county and indicator. For the most accurate percentage values, aggregate all counts back to the county level and compute percentages. In the export file, counties are referred to by the five-digit character supplied by the user to <code>ipd_counties</code>.
<br></p>
<div class="language-r highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="n">export_means</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dl_counts</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">select</span><span class="p">(</span><span class="n">GEOID20</span><span class="p">,</span><span class="w"> </span><span class="nf">ends_with</span><span class="p">(</span><span class="s">&quot;UE&quot;</span><span class="p">),</span><span class="w"> </span><span class="nf">ends_with</span><span class="p">(</span><span class="s">&quot;CE&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a><span class="w">  </span><span class="nf">select</span><span class="p">(</span><span class="n">GEOID20</span><span class="p">,</span><span class="w"> </span><span class="nf">sort</span><span class="p">(</span><span class="n">tidyselect</span><span class="o">::</span><span class="nf">peek_vars</span><span class="p">()))</span><span class="w"> </span><span class="o">%&gt;%</span>
</span><span id="__span-41-3"><a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a><span class="w">  </span><span class="nf">mutate</span><span class="p">(</span><span class="n">County</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">str_sub</span><span class="p">(</span><span class="n">GEOID20</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
</span><span id="__span-41-4"><a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a><span class="w">  </span><span class="nf">select</span><span class="p">(</span><span class="o">-</span><span class="n">GEOID20</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
</span><span id="__span-41-5"><a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a><span class="w">  </span><span class="nf">group_by</span><span class="p">(</span><span class="n">County</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
</span><span id="__span-41-6"><a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a><span class="w">  </span><span class="nf">summarize</span><span class="p">(</span><span class="n">D_PctEst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">D_CE</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">D_UE</span><span class="p">),</span>
</span><span id="__span-41-7"><a id="__codelineno-41-7" name="__codelineno-41-7" href="#__codelineno-41-7"></a><span class="w">            </span><span class="n">EM_PctEst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">EM_CE</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">EM_UE</span><span class="p">),</span>
</span><span id="__span-41-8"><a id="__codelineno-41-8" name="__codelineno-41-8" href="#__codelineno-41-8"></a><span class="w">            </span><span class="n">F_PctEst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">F_CE</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">F_UE</span><span class="p">),</span>
</span><span id="__span-41-9"><a id="__codelineno-41-9" name="__codelineno-41-9" href="#__codelineno-41-9"></a><span class="w">            </span><span class="n">FB_PctEst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">FB_CE</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">FB_UE</span><span class="p">),</span>
</span><span id="__span-41-10"><a id="__codelineno-41-10" name="__codelineno-41-10" href="#__codelineno-41-10"></a><span class="w">            </span><span class="n">LEP_PctEst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">LEP_CE</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">LEP_UE</span><span class="p">),</span>
</span><span id="__span-41-11"><a id="__codelineno-41-11" name="__codelineno-41-11" href="#__codelineno-41-11"></a><span class="w">            </span><span class="n">LI_PctEst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">LI_CE</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">LI_UE</span><span class="p">),</span>
</span><span id="__span-41-12"><a id="__codelineno-41-12" name="__codelineno-41-12" href="#__codelineno-41-12"></a><span class="w">            </span><span class="n">OA_PctEst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">OA_CE</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">OA_UE</span><span class="p">),</span>
</span><span id="__span-41-13"><a id="__codelineno-41-13" name="__codelineno-41-13" href="#__codelineno-41-13"></a><span class="w">            </span><span class="n">RM_PctEst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">RM_CE</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">RM_UE</span><span class="p">),</span>
</span><span id="__span-41-14"><a id="__codelineno-41-14" name="__codelineno-41-14" href="#__codelineno-41-14"></a><span class="w">            </span><span class="n">Y_PctEst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">Y_CE</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">Y_UE</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
</span><span id="__span-41-15"><a id="__codelineno-41-15" name="__codelineno-41-15" href="#__codelineno-41-15"></a><span class="w">  </span><span class="nf">mutate_if</span><span class="p">(</span><span class="n">is.numeric</span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">.</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">100</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
</span><span id="__span-41-16"><a id="__codelineno-41-16" name="__codelineno-41-16" href="#__codelineno-41-16"></a><span class="w">  </span><span class="nf">mutate_if</span><span class="p">(</span><span class="n">is.numeric</span><span class="p">,</span><span class="w"> </span><span class="n">round_1</span><span class="p">)</span>
</span></code></pre></div>
<h2 id="eight_e">8e. Replacing NA with NoData if character and -99999 if numeric</h2>
<p>Now we replace NA with NoData if character and -99999 if numeric so tract 42091206702 doesn't mess up breaks and means by indicator.
<div class="language-r highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="n">ipd</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ipd</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">mutate_if</span><span class="p">(</span><span class="n">is.character</span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="p">(</span><span class="nf">ifelse</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">.</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;NoData&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">.</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span>
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a><span class="w">  </span><span class="nf">mutate_if</span><span class="p">(</span><span class="n">is.numeric</span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="p">(</span><span class="nf">ifelse</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">.</span><span class="p">),</span><span class="w"> </span><span class="m">-99999</span><span class="p">,</span><span class="w"> </span><span class="n">.</span><span class="p">)))</span>
</span><span id="__span-42-3"><a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a><span class="n">ipd_summary</span><span class="p">[</span><span class="n">ipd_summary</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">-99999</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NA</span>
</span></code></pre></div></p>
<p>In addition we extract elements of the GEOID and convert some of the fields to a <code>character</code> data type.</p>
<div class="language-r highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="n">ipd</span><span class="o">$</span><span class="n">STATEFP20</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">str_sub</span><span class="p">(</span><span class="n">ipd</span><span class="o">$</span><span class="n">GEOID20</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-43-2"><a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a><span class="n">ipd</span><span class="o">$</span><span class="n">COUNTYFP20</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">str_sub</span><span class="p">(</span><span class="n">ipd</span><span class="o">$</span><span class="n">GEOID20</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">5</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-43-3"><a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a><span class="n">ipd</span><span class="o">$</span><span class="n">NAME20</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">str_sub</span><span class="p">(</span><span class="n">ipd</span><span class="o">$</span><span class="n">GEOID20</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">11</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-43-4"><a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a>
</span><span id="__span-43-5"><a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a><span class="n">ipd</span><span class="o">$</span><span class="n">GEOID20</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="n">ipd</span><span class="o">$</span><span class="n">GEOID20</span><span class="p">)</span>
</span><span id="__span-43-6"><a id="__codelineno-43-6" name="__codelineno-43-6" href="#__codelineno-43-6"></a><span class="n">ipd</span><span class="o">$</span><span class="n">STATEFP20</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="n">ipd</span><span class="o">$</span><span class="n">STATEFP20</span><span class="p">)</span>
</span><span id="__span-43-7"><a id="__codelineno-43-7" name="__codelineno-43-7" href="#__codelineno-43-7"></a><span class="n">ipd</span><span class="o">$</span><span class="n">COUNTYFP20</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="n">ipd</span><span class="o">$</span><span class="n">COUNTYFP20</span><span class="p">)</span>
</span><span id="__span-43-8"><a id="__codelineno-43-8" name="__codelineno-43-8" href="#__codelineno-43-8"></a><span class="n">ipd</span><span class="o">$</span><span class="n">NAME20</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="n">ipd</span><span class="o">$</span><span class="n">NAME20</span><span class="p">)</span>
</span><span id="__span-43-9"><a id="__codelineno-43-9" name="__codelineno-43-9" href="#__codelineno-43-9"></a><span class="n">ipd</span><span class="o">$</span><span class="n">namelsad</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">paste</span><span class="p">(</span><span class="nf">substr</span><span class="p">(</span><span class="n">ipd</span><span class="o">$</span><span class="n">GEOID20</span><span class="p">,</span><span class="w"> </span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">9</span><span class="p">),</span><span class="w"> </span><span class="nf">substr</span><span class="p">(</span><span class="n">ipd</span><span class="o">$</span><span class="n">GEOID20</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">11</span><span class="p">),</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;.&quot;</span><span class="p">)</span>
</span></code></pre></div>
<h1 id="export">9. Export</h1>
<h2 id="nine_a">9a. Append to TIGER/LINE file</h2>
<p>Using the arguments supplied in <code>ipd_county</code>, download the relevant census tracts and append <code>ipd</code> to them. Uncommenting <code>cb = TRUE</code> will greatly speed processing time by downloading generalized tract boundary shapefiles instead of detailed ones.
<br></p>
<div class="language-r highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="nf">options</span><span class="p">(</span><span class="n">tigris_use_cache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">tigris_class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;sf&quot;</span><span class="p">)</span>
</span><span id="__span-44-2"><a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a><span class="n">st</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">str_sub</span><span class="p">(</span><span class="n">ipd_counties</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">)</span>
</span><span id="__span-44-3"><a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a><span class="n">cty</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">str_sub</span><span class="p">(</span><span class="n">ipd_counties</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">)</span>
</span><span id="__span-44-4"><a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a><span class="n">trct</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">map2</span><span class="p">(</span><span class="n">st</span><span class="p">,</span><span class="w"> </span><span class="n">cty</span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="p">{</span><span class="nf">tracts</span><span class="p">(</span><span class="n">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">.x</span><span class="p">,</span>
</span><span id="__span-44-5"><a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a><span class="w">                               </span><span class="n">county</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">.y</span><span class="p">,</span>
</span><span id="__span-44-6"><a id="__codelineno-44-6" name="__codelineno-44-6" href="#__codelineno-44-6"></a><span class="w">                               </span><span class="c1">#cb = TRUE,</span>
</span><span id="__span-44-7"><a id="__codelineno-44-7" name="__codelineno-44-7" href="#__codelineno-44-7"></a><span class="w">                               </span><span class="n">year</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ipd_year</span><span class="p">)})</span><span class="w"> </span><span class="o">%&gt;%</span>
</span><span id="__span-44-8"><a id="__codelineno-44-8" name="__codelineno-44-8" href="#__codelineno-44-8"></a><span class="w">  </span><span class="nf">rbind_tigris</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span>
</span><span id="__span-44-9"><a id="__codelineno-44-9" name="__codelineno-44-9" href="#__codelineno-44-9"></a><span class="w">  </span><span class="nf">st_transform</span><span class="p">(</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="m">26918</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
</span><span id="__span-44-10"><a id="__codelineno-44-10" name="__codelineno-44-10" href="#__codelineno-44-10"></a><span class="w">  </span><span class="nf">select</span><span class="p">(</span><span class="n">GEOID</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
</span><span id="__span-44-11"><a id="__codelineno-44-11" name="__codelineno-44-11" href="#__codelineno-44-11"></a><span class="w">  </span><span class="nf">left_join</span><span class="p">(</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">ipd</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;GEOID&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;GEOID20&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
</span><span id="__span-44-12"><a id="__codelineno-44-12" name="__codelineno-44-12" href="#__codelineno-44-12"></a><span class="w">  </span><span class="nf">rename</span><span class="p">(</span><span class="n">GEOID20</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GEOID</span><span class="p">)</span>
</span></code></pre></div>
<h2 id="nine_b">9b. Export files</h2>
<p>Results are saved in <code>outputs</code>.
<br></p>
<div class="language-r highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="nf">st_write</span><span class="p">(</span><span class="n">trct</span><span class="p">,</span><span class="w"> </span><span class="nf">here</span><span class="p">(</span><span class="s">&quot;outputs&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;ipd_2021.shp&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">delete_dsn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">quiet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span>
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a><span class="nf">write_csv</span><span class="p">(</span><span class="n">ipd</span><span class="p">,</span><span class="w"> </span><span class="nf">here</span><span class="p">(</span><span class="s">&quot;outputs&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;ipd_2021.csv&quot;</span><span class="p">))</span>
</span><span id="__span-45-3"><a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a><span class="nf">write_csv</span><span class="p">(</span><span class="n">export_counts</span><span class="p">,</span><span class="w"> </span><span class="nf">here</span><span class="p">(</span><span class="s">&quot;outputs&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;counts_by_indicator_2021.csv&quot;</span><span class="p">))</span>
</span><span id="__span-45-4"><a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a><span class="nf">write_csv</span><span class="p">(</span><span class="n">export_breaks</span><span class="p">,</span><span class="w"> </span><span class="nf">here</span><span class="p">(</span><span class="s">&quot;outputs&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;breaks_by_indicator_2021.csv&quot;</span><span class="p">))</span>
</span><span id="__span-45-5"><a id="__codelineno-45-5" name="__codelineno-45-5" href="#__codelineno-45-5"></a><span class="nf">write_csv</span><span class="p">(</span><span class="n">export_summary</span><span class="p">,</span><span class="w"> </span><span class="nf">here</span><span class="p">(</span><span class="s">&quot;outputs&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;summary_by_indicator_2021.csv&quot;</span><span class="p">))</span>
</span><span id="__span-45-6"><a id="__codelineno-45-6" name="__codelineno-45-6" href="#__codelineno-45-6"></a><span class="nf">write_csv</span><span class="p">(</span><span class="n">export_means</span><span class="p">,</span><span class="w"> </span><span class="nf">here</span><span class="p">(</span><span class="s">&quot;outputs&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;mean_by_county_2021.csv&quot;</span><span class="p">))</span>
</span></code></pre></div>
<h1 id="metadata">10. Metadata table with sources</h1>
<p>This is a table of the final output with some additional data such as municipality name and area added but not included in the script.
<br></p>
<table>
<thead>
<tr>
<th style="text-align: left;">Variable</th>
<th style="text-align: center;">Concept</th>
<th style="text-align: center;">acs table</th>
<th style="text-align: center;">acs variable</th>
<th style="text-align: center;">data source</th>
<th style="text-align: center;">Source Type</th>
<th style="text-align: right;">Universe Variable</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">geoid20</td>
<td style="text-align: center;">11-digit tract GEOID</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">ACS 5-year</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: right;">n/a</td>
</tr>
<tr>
<td style="text-align: left;">statefp20</td>
<td style="text-align: center;">2-digit state GEOID</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">ACS 5-year</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: right;">n/a</td>
</tr>
<tr>
<td style="text-align: left;">countyfp20</td>
<td style="text-align: center;">3-digit county GEOID</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">ACS 5-year</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: right;">n/a</td>
</tr>
<tr>
<td style="text-align: left;">name20</td>
<td style="text-align: center;">Tract and county name</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">ACS 5-year</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: right;">n/a</td>
</tr>
<tr>
<td style="text-align: left;">d_class</td>
<td style="text-align: center;">Disabled percentile class</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: right;">S1810_C01_001</td>
</tr>
<tr>
<td style="text-align: left;">d_cntest</td>
<td style="text-align: center;">Disabled count estimate</td>
<td style="text-align: center;">S1810_C02_001_E</td>
<td style="text-align: center;">acs variable</td>
<td style="text-align: center;">ACS 5-year</td>
<td style="text-align: center;">acs variable</td>
<td style="text-align: right;">S1810_C01_001</td>
</tr>
<tr>
<td style="text-align: left;">d_cntmoe</td>
<td style="text-align: center;">Disabled count margin of error</td>
<td style="text-align: center;">S1810_C02_001_M</td>
<td style="text-align: center;">acs variable</td>
<td style="text-align: center;">ACS 5-year</td>
<td style="text-align: center;">acs variable</td>
<td style="text-align: right;">S1810_C01_001</td>
</tr>
<tr>
<td style="text-align: left;">d_pctest</td>
<td style="text-align: center;">Disabled percent estimate</td>
<td style="text-align: center;">S1810_C03_001_E</td>
<td style="text-align: center;">acs variable</td>
<td style="text-align: center;">ACS 5-year</td>
<td style="text-align: center;">acs variable</td>
<td style="text-align: right;">S1810_C01_001</td>
</tr>
<tr>
<td style="text-align: left;">d_pctile</td>
<td style="text-align: center;">Disabled percentile</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: right;">S1810_C01_001</td>
</tr>
<tr>
<td style="text-align: left;">d_pctmoe</td>
<td style="text-align: center;">Disabled percent margin of error</td>
<td style="text-align: center;">S1810_C03_001_M</td>
<td style="text-align: center;">acs variable</td>
<td style="text-align: center;">ACS 5-year</td>
<td style="text-align: center;">acs variable</td>
<td style="text-align: right;">S1810_C01_001</td>
</tr>
<tr>
<td style="text-align: left;">d_score</td>
<td style="text-align: center;">Disabled percentile score</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: right;">S1810_C01_001</td>
</tr>
<tr>
<td style="text-align: left;">em_class</td>
<td style="text-align: center;">Ethnic minority percentile class</td>
<td style="text-align: center;">B03002</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: right;">B03002_001</td>
</tr>
<tr>
<td style="text-align: left;">em_cntest</td>
<td style="text-align: center;">Ethnic minority count estimate</td>
<td style="text-align: center;">B03002</td>
<td style="text-align: center;">B03002_012_E</td>
<td style="text-align: center;">ACS 5-year</td>
<td style="text-align: center;">acs variable</td>
<td style="text-align: right;">B03002_001</td>
</tr>
<tr>
<td style="text-align: left;">em_cntmoe</td>
<td style="text-align: center;">Ethnic minority count margin of error</td>
<td style="text-align: center;">B03002</td>
<td style="text-align: center;">B03002_012_M</td>
<td style="text-align: center;">ACS 5-year</td>
<td style="text-align: center;">acs variable</td>
<td style="text-align: right;">B03002_001</td>
</tr>
<tr>
<td style="text-align: left;">em_pctest</td>
<td style="text-align: center;">Ethnic minority percent estimate</td>
<td style="text-align: center;">B03002</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: right;">B03002_001</td>
</tr>
<tr>
<td style="text-align: left;">em_pctile</td>
<td style="text-align: center;">Ethnic minority percentile</td>
<td style="text-align: center;">B03002</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: right;">B03002_001</td>
</tr>
<tr>
<td style="text-align: left;">em_pctmoe</td>
<td style="text-align: center;">Ethnic minority percent margin of error</td>
<td style="text-align: center;">B03002</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: right;">B03002_001</td>
</tr>
<tr>
<td style="text-align: left;">em_score</td>
<td style="text-align: center;">Ethnic minority percentile score</td>
<td style="text-align: center;">B03002</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: right;">B03002_001</td>
</tr>
<tr>
<td style="text-align: left;">f_class</td>
<td style="text-align: center;">Female percentile class</td>
<td style="text-align: center;">S0101</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: right;">S0101_C01_001</td>
</tr>
<tr>
<td style="text-align: left;">f_cntest</td>
<td style="text-align: center;">Female count estimate</td>
<td style="text-align: center;">S0101</td>
<td style="text-align: center;">S0101_C05_001_E</td>
<td style="text-align: center;">ACS 5-year</td>
<td style="text-align: center;">acs variable</td>
<td style="text-align: right;">S0101_C01_001</td>
</tr>
<tr>
<td style="text-align: left;">f_cntmoe</td>
<td style="text-align: center;">Female count margin of error</td>
<td style="text-align: center;">S0101</td>
<td style="text-align: center;">S0101_C05_001_M</td>
<td style="text-align: center;">ACS 5-year</td>
<td style="text-align: center;">acs variable</td>
<td style="text-align: right;">S0101_C01_001</td>
</tr>
<tr>
<td style="text-align: left;">f_pctest</td>
<td style="text-align: center;">Female percent estimate</td>
<td style="text-align: center;">S0101</td>
<td style="text-align: center;">DP05_0003PE_E</td>
<td style="text-align: center;">ACS 5-year</td>
<td style="text-align: center;">acs variable</td>
<td style="text-align: right;">S0101_C01_001</td>
</tr>
<tr>
<td style="text-align: left;">f_pctile</td>
<td style="text-align: center;">Female percentile</td>
<td style="text-align: center;">S0101</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: right;">S0101_C01_001</td>
</tr>
<tr>
<td style="text-align: left;">f_pctmoe</td>
<td style="text-align: center;">Female percent margin of error</td>
<td style="text-align: center;">S0101</td>
<td style="text-align: center;">DP05_0003PE_M</td>
<td style="text-align: center;">ACS 5-year</td>
<td style="text-align: center;">acs variable</td>
<td style="text-align: right;">S0101_C01_001</td>
</tr>
<tr>
<td style="text-align: left;">f_score</td>
<td style="text-align: center;">Female percentile score</td>
<td style="text-align: center;">S0101</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: right;">S0101_C01_001</td>
</tr>
<tr>
<td style="text-align: left;">fb_class</td>
<td style="text-align: center;">Foreign-born percentile class</td>
<td style="text-align: center;">B05012</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: right;">B05012_001</td>
</tr>
<tr>
<td style="text-align: left;">fb_cntest</td>
<td style="text-align: center;">Foreign-born count estimate</td>
<td style="text-align: center;">B05012</td>
<td style="text-align: center;">B05012_003_E</td>
<td style="text-align: center;">ACS 5-year</td>
<td style="text-align: center;">acs variable</td>
<td style="text-align: right;">B05012_001</td>
</tr>
<tr>
<td style="text-align: left;">fb_cntmoe</td>
<td style="text-align: center;">Foreign-born count margin of error</td>
<td style="text-align: center;">B05012</td>
<td style="text-align: center;">B05012_003_M</td>
<td style="text-align: center;">ACS 5-year</td>
<td style="text-align: center;">acs variable</td>
<td style="text-align: right;">B05012_001</td>
</tr>
<tr>
<td style="text-align: left;">fb_pctest</td>
<td style="text-align: center;">Foreign-born percent estimate</td>
<td style="text-align: center;">B05012</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: right;">B05012_001</td>
</tr>
<tr>
<td style="text-align: left;">fb_pctile</td>
<td style="text-align: center;">Foreign-born percentile</td>
<td style="text-align: center;">B05012</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: right;">B05012_001</td>
</tr>
<tr>
<td style="text-align: left;">fb_pctmoe</td>
<td style="text-align: center;">Foreign-born percent margin of error</td>
<td style="text-align: center;">B05012</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: right;">B05012_001</td>
</tr>
<tr>
<td style="text-align: left;">fb_score</td>
<td style="text-align: center;">Foreign-born percentile score</td>
<td style="text-align: center;">B05012</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: right;">S1601_C01_001</td>
</tr>
<tr>
<td style="text-align: left;">lep_class</td>
<td style="text-align: center;">Limited English proficiency percentile class</td>
<td style="text-align: center;">S1601</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: right;">S1601_C01_001</td>
</tr>
<tr>
<td style="text-align: left;">lep_cntest</td>
<td style="text-align: center;">Limited English proficiency count estimate</td>
<td style="text-align: center;">S1601</td>
<td style="text-align: center;">S1601_C05_001_E</td>
<td style="text-align: center;">ACS 5-year</td>
<td style="text-align: center;">acs variable</td>
<td style="text-align: right;">S1601_C01_001</td>
</tr>
<tr>
<td style="text-align: left;">lep_cntmoe</td>
<td style="text-align: center;">Limited English proficiency count margin of error</td>
<td style="text-align: center;">S1601</td>
<td style="text-align: center;">S1601_C05_001_M</td>
<td style="text-align: center;">ACS 5-year</td>
<td style="text-align: center;">acs variable</td>
<td style="text-align: right;">S1601_C01_001</td>
</tr>
<tr>
<td style="text-align: left;">lep_pctest</td>
<td style="text-align: center;">Limited English proficiency percent estimate</td>
<td style="text-align: center;">S1601</td>
<td style="text-align: center;">S1601_C06_001_E</td>
<td style="text-align: center;">ACS 5-year</td>
<td style="text-align: center;">acs variable</td>
<td style="text-align: right;">S1601_C01_001</td>
</tr>
<tr>
<td style="text-align: left;">lep_pctile</td>
<td style="text-align: center;">Limited English proficiency percentile</td>
<td style="text-align: center;">S1601</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: right;">S1601_C01_001</td>
</tr>
<tr>
<td style="text-align: left;">lep_pctmoe</td>
<td style="text-align: center;">Limited English proficiency percent margin of error</td>
<td style="text-align: center;">S1601</td>
<td style="text-align: center;">S1601_C06_001_M</td>
<td style="text-align: center;">ACS 5-year</td>
<td style="text-align: center;">acs variable</td>
<td style="text-align: right;">S1601_C01_001</td>
</tr>
<tr>
<td style="text-align: left;">lep_score</td>
<td style="text-align: center;">Limited English proficiency percentile score</td>
<td style="text-align: center;">S1601</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: right;">S1601_C01_001</td>
</tr>
<tr>
<td style="text-align: left;">li_class</td>
<td style="text-align: center;">Low-income percentile class</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: right;">S1701_C01_001</td>
</tr>
<tr>
<td style="text-align: left;">li_cntest</td>
<td style="text-align: center;">Low-income count estimate</td>
<td style="text-align: center;">S1701</td>
<td style="text-align: center;">S1701_C01_042_E</td>
<td style="text-align: center;">ACS 5-year</td>
<td style="text-align: center;">acs variable</td>
<td style="text-align: right;">S1701_C01_001</td>
</tr>
<tr>
<td style="text-align: left;">li_cntmoe</td>
<td style="text-align: center;">Low-income count margin of error</td>
<td style="text-align: center;">S1701</td>
<td style="text-align: center;">S1701_C01_042_M</td>
<td style="text-align: center;">ACS 5-year</td>
<td style="text-align: center;">acs variable</td>
<td style="text-align: right;">S1701_C01_001</td>
</tr>
<tr>
<td style="text-align: left;">li_pctest</td>
<td style="text-align: center;">Low-income percent estimate</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: right;">S1701_C01_001</td>
</tr>
<tr>
<td style="text-align: left;">li_pctile</td>
<td style="text-align: center;">Low-income percentile</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: right;">S1701_C01_001</td>
</tr>
<tr>
<td style="text-align: left;">li_pctmoe</td>
<td style="text-align: center;">Low-income percent margin of error</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: right;">S1701_C01_001</td>
</tr>
<tr>
<td style="text-align: left;">li_score</td>
<td style="text-align: center;">Low-income percentile score</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: right;">S1701_C01_001</td>
</tr>
<tr>
<td style="text-align: left;">oa_class</td>
<td style="text-align: center;">Older adult percentile class</td>
<td style="text-align: center;">S0101</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: right;">B02001_001</td>
</tr>
<tr>
<td style="text-align: left;">oa_cntest</td>
<td style="text-align: center;">Older adult count estimate</td>
<td style="text-align: center;">S0101</td>
<td style="text-align: center;">S0101_C01_001_E</td>
<td style="text-align: center;">ACS 5-year</td>
<td style="text-align: center;">acs variable</td>
<td style="text-align: right;">B02001_001</td>
</tr>
<tr>
<td style="text-align: left;">oa_cntmoe</td>
<td style="text-align: center;">Older adult count margin of error</td>
<td style="text-align: center;">S0101</td>
<td style="text-align: center;">S0101_C01_001_M</td>
<td style="text-align: center;">ACS 5-year</td>
<td style="text-align: center;">acs variable</td>
<td style="text-align: right;">B02001_001</td>
</tr>
<tr>
<td style="text-align: left;">oa_pctest</td>
<td style="text-align: center;">Older adult percent estimate</td>
<td style="text-align: center;">S0101</td>
<td style="text-align: center;">S0101_C02_030_E</td>
<td style="text-align: center;">ACS 5-year</td>
<td style="text-align: center;">acs variable</td>
<td style="text-align: right;">B02001_001</td>
</tr>
<tr>
<td style="text-align: left;">oa_pctile</td>
<td style="text-align: center;">Older adult percentile</td>
<td style="text-align: center;">S0101</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: right;">B02001_001</td>
</tr>
<tr>
<td style="text-align: left;">oa_pctmoe</td>
<td style="text-align: center;">Older adult percent margin of error</td>
<td style="text-align: center;">S0101</td>
<td style="text-align: center;">S0101_C02_030_M</td>
<td style="text-align: center;">ACS 5-year</td>
<td style="text-align: center;">acs variable</td>
<td style="text-align: right;">B02001_001</td>
</tr>
<tr>
<td style="text-align: left;">oa_score</td>
<td style="text-align: center;">Older adult percentile score</td>
<td style="text-align: center;">S0101</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: right;">B02001_001</td>
</tr>
<tr>
<td style="text-align: left;">rm_class</td>
<td style="text-align: center;">Racial minority percentile class</td>
<td style="text-align: center;">B02001</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: right;">B02001_001</td>
</tr>
<tr>
<td style="text-align: left;">rm_cntest</td>
<td style="text-align: center;">Racial minority count estimate</td>
<td style="text-align: center;">B02001</td>
<td style="text-align: center;">B02001_002_E</td>
<td style="text-align: center;">ACS 5-year</td>
<td style="text-align: center;">acs variable</td>
<td style="text-align: right;">B02001_001</td>
</tr>
<tr>
<td style="text-align: left;">rm_cntmoe</td>
<td style="text-align: center;">Racial minority count margin of error</td>
<td style="text-align: center;">B02001</td>
<td style="text-align: center;">B02001_002_M</td>
<td style="text-align: center;">ACS 5-year</td>
<td style="text-align: center;">acs variable</td>
<td style="text-align: right;">B02001_001</td>
</tr>
<tr>
<td style="text-align: left;">rm_pctest</td>
<td style="text-align: center;">Racial minority percent estimate</td>
<td style="text-align: center;">B02001</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: right;">B02001_001</td>
</tr>
<tr>
<td style="text-align: left;">rm_pctile</td>
<td style="text-align: center;">Racial minority percentile</td>
<td style="text-align: center;">B02001</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: right;">B02001_001</td>
</tr>
<tr>
<td style="text-align: left;">rm_pctmoe</td>
<td style="text-align: center;">Racial minority percent margin of error</td>
<td style="text-align: center;">B02001</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: right;">B02001_001</td>
</tr>
<tr>
<td style="text-align: left;">rm_score</td>
<td style="text-align: center;">Racial minority percentile score</td>
<td style="text-align: center;">B02001</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: right;">B02001_001</td>
</tr>
<tr>
<td style="text-align: left;">y_class</td>
<td style="text-align: center;">Youth percentile class</td>
<td style="text-align: center;">B09001</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: right;">B03002_001</td>
</tr>
<tr>
<td style="text-align: left;">y_cntest</td>
<td style="text-align: center;">Youth count estimate</td>
<td style="text-align: center;">B09001</td>
<td style="text-align: center;">B09001_001</td>
<td style="text-align: center;">ACS 5-year</td>
<td style="text-align: center;">acs variable</td>
<td style="text-align: right;">B03002_001</td>
</tr>
<tr>
<td style="text-align: left;">y_cntmoe</td>
<td style="text-align: center;">Youth count margin of error</td>
<td style="text-align: center;">B09001</td>
<td style="text-align: center;">B09001_001</td>
<td style="text-align: center;">ACS 5-year</td>
<td style="text-align: center;">acs variable</td>
<td style="text-align: right;">B03002_001</td>
</tr>
<tr>
<td style="text-align: left;">y_pctest</td>
<td style="text-align: center;">Youth population percentage estimate</td>
<td style="text-align: center;">B09001</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: right;">B03002_001</td>
</tr>
<tr>
<td style="text-align: left;">y_pctile</td>
<td style="text-align: center;">Youth population percentile</td>
<td style="text-align: center;">B09001</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: right;">B03002_001</td>
</tr>
<tr>
<td style="text-align: left;">y_pctmoe</td>
<td style="text-align: center;">Youth population percentage margin of error</td>
<td style="text-align: center;">B09001</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: right;">B03002_001</td>
</tr>
<tr>
<td style="text-align: left;">y_score</td>
<td style="text-align: center;">Youth percentile score</td>
<td style="text-align: center;">B09001</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: right;">B03002_001</td>
</tr>
<tr>
<td style="text-align: left;">ipd_score</td>
<td style="text-align: center;">Indicator of potential disadvantage score</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: right;">n/a</td>
</tr>
<tr>
<td style="text-align: left;">u_tpopest</td>
<td style="text-align: center;">Total population estimate</td>
<td style="text-align: center;">B02001</td>
<td style="text-align: center;">B02001_001_E</td>
<td style="text-align: center;">ACS 5-year</td>
<td style="text-align: center;">acs variable</td>
<td style="text-align: right;">B02001_001</td>
</tr>
<tr>
<td style="text-align: left;">u_tpopmoe</td>
<td style="text-align: center;">Total population margin of error</td>
<td style="text-align: center;">B02001</td>
<td style="text-align: center;">B02001_001_E</td>
<td style="text-align: center;">ACS 5-year</td>
<td style="text-align: center;">acs variable</td>
<td style="text-align: right;">B02001_001</td>
</tr>
<tr>
<td style="text-align: left;">u_pop6est</td>
<td style="text-align: center;">Population over 6 years of age estimate</td>
<td style="text-align: center;">S1601</td>
<td style="text-align: center;">S1601_C01_001_E</td>
<td style="text-align: center;">ACS 5-year</td>
<td style="text-align: center;">acs variable</td>
<td style="text-align: right;">S1601_C01_001</td>
</tr>
<tr>
<td style="text-align: left;">u_pop6moe</td>
<td style="text-align: center;">Population over 6 years of age margin of error</td>
<td style="text-align: center;">S1601</td>
<td style="text-align: center;">S1601_C01_001_M</td>
<td style="text-align: center;">ACS 5-year</td>
<td style="text-align: center;">acs variable</td>
<td style="text-align: right;">S1601_C01_001</td>
</tr>
<tr>
<td style="text-align: left;">u_ppovest</td>
<td style="text-align: center;">Total population poverty rate estimate</td>
<td style="text-align: center;">S1701</td>
<td style="text-align: center;">S1701_C01_001_E</td>
<td style="text-align: center;">ACS 5-year</td>
<td style="text-align: center;">acs variable</td>
<td style="text-align: right;">S1701_C01_001</td>
</tr>
<tr>
<td style="text-align: left;">u_ppovmoe</td>
<td style="text-align: center;">Total population poverty rate margin of error</td>
<td style="text-align: center;">S1701</td>
<td style="text-align: center;">S1701_C01_001_M</td>
<td style="text-align: center;">ACS 5-year</td>
<td style="text-align: center;">acs variable</td>
<td style="text-align: right;">S1701_C01_001</td>
</tr>
<tr>
<td style="text-align: left;">u_pnicest</td>
<td style="text-align: center;">Disabled universe total estimate</td>
<td style="text-align: center;">S1810</td>
<td style="text-align: center;">S1810_C01_001_E</td>
<td style="text-align: center;">ACS 5-year</td>
<td style="text-align: center;">acs variable</td>
<td style="text-align: right;">S1810_C01_001</td>
</tr>
<tr>
<td style="text-align: left;">u_pnicmoe</td>
<td style="text-align: center;">Disabled universe total margin of error</td>
<td style="text-align: center;">S1810</td>
<td style="text-align: center;">S1810_C01_001_M</td>
<td style="text-align: center;">ACS 5-year</td>
<td style="text-align: center;">acs variable</td>
<td style="text-align: right;">S1810_C01_001</td>
</tr>
<tr>
<td style="text-align: left;">namelsad</td>
<td style="text-align: center;">Geography name</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">ACS 5-year</td>
<td style="text-align: center;">acs variable</td>
<td style="text-align: right;">n/a</td>
</tr>
<tr>
<td style="text-align: left;">mun1</td>
<td style="text-align: center;">First municipality name</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: right;">n/a</td>
</tr>
<tr>
<td style="text-align: left;">mun2</td>
<td style="text-align: center;">Second municipality name</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: right;">n/a</td>
</tr>
<tr>
<td style="text-align: left;">mun3</td>
<td style="text-align: center;">Third municipality name</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: right;">n/a</td>
</tr>
<tr>
<td style="text-align: left;">co_name</td>
<td style="text-align: center;">County Name</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: center;">calculated</td>
<td style="text-align: right;">n/a</td>
</tr>
<tr>
<td style="text-align: left;">state</td>
<td style="text-align: center;">State name</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">ACS 5-year</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: right;">n/a</td>
</tr>
<tr>
<td style="text-align: left;">st_area(shape)</td>
<td style="text-align: center;">Area of a geometry</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">ACS 5-year</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: right;">n/a</td>
</tr>
<tr>
<td style="text-align: left;">st_perimeter(shape)</td>
<td style="text-align: center;">Perimeter of the geometry</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: center;">ACS 5-year</td>
<td style="text-align: center;">n/a</td>
<td style="text-align: right;">n/a</td>
</tr>
</tbody>
</table>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      &copy; 2023 <a href="https://github.com/dvrpc"  target="_blank" rel="noopener">DVRPC</a>

    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/dvrpc" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/DVRPC?ref_src=twsrc%5Egoogle%7Ctwcamp%5Eserp%7Ctwgr%5Eauthor" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.youtube.com/channel/UCEU8UI5_iGkVypHP93b5jLA" target="_blank" rel="noopener" title="www.youtube.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": ".", "features": ["navigation.tabs", "navigation.sections", "toc.integrate", "navigation.top", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotation", "content.code.copy", "content.code.select", "content.code.annotate"], "search": "assets/javascripts/workers/search.a264c092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="assets/javascripts/bundle.4e0fa4ba.min.js"></script>
      
    
  </body>
</html>